<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MONC: halo_communication_mod Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MONC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">halo_communication_mod Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Provides the mechanism for halo swapping. This module contains the functionality required to determine what messages get sent where, pack data up en mass, send and receive from neighbouring processes and unpack into the appropriate data locations. There is also some functionality to help local copying of data to corresponding locations. The idea is that the caller will determine the policy (i.e. exactly what fields are to be communicated) through procedure arguments and this mechanism can be used again and again. It implements bulk sending of all field data in one large message to reduce communication overhead.  
<a href="namespacehalo__communication__mod.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">interface &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interfacehalo__communication__mod_1_1copy__corners__to__halo__buffer__proc__interface.html">copy_corners_to_halo_buffer_proc_interface</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">interface &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interfacehalo__communication__mod_1_1copy__fields__to__halo__buffer__proc__interface.html">copy_fields_to_halo_buffer_proc_interface</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">interface &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interfacehalo__communication__mod_1_1copy__halo__buffer__to__corner__proc__interface.html">copy_halo_buffer_to_corner_proc_interface</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">interface &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interfacehalo__communication__mod_1_1copy__halo__buffer__to__field__proc__interface.html">copy_halo_buffer_to_field_proc_interface</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">interface &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interfacehalo__communication__mod_1_1get__fields__per__halo__cell__proc__interface.html">get_fields_per_halo_cell_proc_interface</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Procedure interfaces used to determine the policy (i.e. the fields) of halo swapping and.  <a href="interfacehalo__communication__mod_1_1get__fields__per__halo__cell__proc__interface.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">interface &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html">perform_local_data_copy_proc_interface</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a0a11eeeaa1e80eab180fb8652ce592a6"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a0a11eeeaa1e80eab180fb8652ce592a6">blocking_halo_swap</a> (current_state, halo_swap_state, copy_to_halo_buffer, perform_local_data_copy, copy_from_halo_buffer, copy_corners_to_halo_buffer, copy_from_halo_buffer_to_corner, source_data)</td></tr>
<tr class="memdesc:a0a11eeeaa1e80eab180fb8652ce592a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs the entire halo swap operation, this is simply a wrapper around the nonblocking initiate and complete procedures and saves the programmer from calling these directly if they do not wish to interleave any computation.  <a href="namespacehalo__communication__mod.html#a0a11eeeaa1e80eab180fb8652ce592a6">More...</a><br /></td></tr>
<tr class="separator:a0a11eeeaa1e80eab180fb8652ce592a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02b04565afda3dc93273a16944a2976e"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a02b04565afda3dc93273a16944a2976e">complete_nonblocking_halo_swap</a> (current_state, halo_swap_state, perform_local_data_copy, copy_from_halo_buffer, copy_from_halo_buffer_to_corner, source_data)</td></tr>
<tr class="memdesc:a02b04565afda3dc93273a16944a2976e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This completes a nonblocking halo swap and it is only during this call that the data fields themselves are modified. This will perform local data copying, wait for all outstanding receives to complete, copy the received buffer data into the data and then wait for all outstanding sends to complete.  <a href="namespacehalo__communication__mod.html#a02b04565afda3dc93273a16944a2976e">More...</a><br /></td></tr>
<tr class="separator:a02b04565afda3dc93273a16944a2976e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8dac8c6529d0169c9e4402690f62d581"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a8dac8c6529d0169c9e4402690f62d581">initiate_nonblocking_halo_swap</a> (current_state, halo_swap_state, copy_to_halo_buffer, copy_corners_to_halo_buffer, source_data)</td></tr>
<tr class="memdesc:a8dac8c6529d0169c9e4402690f62d581"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initiates a non blocking halo swap, this registers the receive requests, copies data into the send buffer and then registers send requests for these. As far as this call is concerned, the data is immutable - no modifications will take place to it until the matching completion call is made.  <a href="namespacehalo__communication__mod.html#a8dac8c6529d0169c9e4402690f62d581">More...</a><br /></td></tr>
<tr class="separator:a8dac8c6529d0169c9e4402690f62d581"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac287e4b520fd9a75f35e58e67ec52880"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#ac287e4b520fd9a75f35e58e67ec52880">init_halo_communication</a> (current_state, get_fields_per_halo_cell, halo_state, halo_depth, involve_corners)</td></tr>
<tr class="memdesc:ac287e4b520fd9a75f35e58e67ec52880"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialises a halo swapping state, by determining the neighbours, size of data in each swap and allocating the required memory - which are communication buffers and request handles. All this information is placed into the returned state.  <a href="namespacehalo__communication__mod.html#ac287e4b520fd9a75f35e58e67ec52880">More...</a><br /></td></tr>
<tr class="separator:ac287e4b520fd9a75f35e58e67ec52880"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f9daddadb8276b6a0d2d13e2e8ce1d5"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a9f9daddadb8276b6a0d2d13e2e8ce1d5">finalise_halo_communication</a> (halo_swap_state)</td></tr>
<tr class="memdesc:a9f9daddadb8276b6a0d2d13e2e8ce1d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finalises the halo swap represented by the state by freeing up all the allocated memory.  <a href="namespacehalo__communication__mod.html#a9f9daddadb8276b6a0d2d13e2e8ce1d5">More...</a><br /></td></tr>
<tr class="separator:a9f9daddadb8276b6a0d2d13e2e8ce1d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40d0a9734a3909fce7b6648cb6f7232f"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a40d0a9734a3909fce7b6648cb6f7232f">copy_buffer_to_corner</a> (local_grid, halo_buffer, field_data, corner_loc, x_target_index, y_target_index, halo_page)</td></tr>
<tr class="memdesc:a40d0a9734a3909fce7b6648cb6f7232f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies the received buffer for a specific field to the corresponding corner of that field.  <a href="namespacehalo__communication__mod.html#a40d0a9734a3909fce7b6648cb6f7232f">More...</a><br /></td></tr>
<tr class="separator:a40d0a9734a3909fce7b6648cb6f7232f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af69a6efcccb7091a6735135bb468c765"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#af69a6efcccb7091a6735135bb468c765">copy_buffer_to_field</a> (local_grid, halo_buffer, field_data, dim, target_index, halo_page)</td></tr>
<tr class="memdesc:af69a6efcccb7091a6735135bb468c765"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies the received buffer for a specific field to the corresponding halo data of that prognostic field.  <a href="namespacehalo__communication__mod.html#af69a6efcccb7091a6735135bb468c765">More...</a><br /></td></tr>
<tr class="separator:af69a6efcccb7091a6735135bb468c765"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a213c2f386f6a61af7053b74d9c3babbb"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a213c2f386f6a61af7053b74d9c3babbb">copy_field_to_buffer</a> (local_grid, halo_buffer, field_data, dim, source_index, halo_page)</td></tr>
<tr class="memdesc:a213c2f386f6a61af7053b74d9c3babbb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies prognostic field data to send buffer for specific field, dimension, halo cell.  <a href="namespacehalo__communication__mod.html#a213c2f386f6a61af7053b74d9c3babbb">More...</a><br /></td></tr>
<tr class="separator:a213c2f386f6a61af7053b74d9c3babbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef632552711c3ad468d0bbcc320fd238"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#aef632552711c3ad468d0bbcc320fd238">copy_corner_to_buffer</a> (local_grid, halo_buffer, field_data, corner_loc, x_source_index, y_source_index, halo_page)</td></tr>
<tr class="memdesc:aef632552711c3ad468d0bbcc320fd238"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies prognostic field corner data to send buffer for specific field.  <a href="namespacehalo__communication__mod.html#aef632552711c3ad468d0bbcc320fd238">More...</a><br /></td></tr>
<tr class="separator:aef632552711c3ad468d0bbcc320fd238"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2eba69a892b0533614ecccad674e61ed"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a2eba69a892b0533614ecccad674e61ed">perform_local_data_copy_for_field</a> (field_data, local_grid, my_rank, halo_depth, involve_corners)</td></tr>
<tr class="memdesc:a2eba69a892b0533614ecccad674e61ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Will perform a a local copy for the halo data of a field.  <a href="namespacehalo__communication__mod.html#a2eba69a892b0533614ecccad674e61ed">More...</a><br /></td></tr>
<tr class="separator:a2eba69a892b0533614ecccad674e61ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7094ec3a38213e4ae98ec0af56f30bd2"><td class="memItemLeft" align="right" valign="top">integer function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a7094ec3a38213e4ae98ec0af56f30bd2">get_number_communication_requests</a> (halo_swap_neighbours, number_distinct_neighbours)</td></tr>
<tr class="memdesc:a7094ec3a38213e4ae98ec0af56f30bd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines the overall number of communication requests, which is made up of normal halo swaps and potentially corner swaps too if that is enabled.  <a href="namespacehalo__communication__mod.html#a7094ec3a38213e4ae98ec0af56f30bd2">More...</a><br /></td></tr>
<tr class="separator:a7094ec3a38213e4ae98ec0af56f30bd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b7d290453fe4d5d7cb784fdd7970227"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a2b7d290453fe4d5d7cb784fdd7970227">determine_recv_and_send_sizes</a> (local_grid, halo_swap_neighbours, number_distinct_neighbours, involve_corners)</td></tr>
<tr class="memdesc:a2b7d290453fe4d5d7cb784fdd7970227"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines the amount (in elements) of data that each neighbour will be sent and I will receive from in a halo swap.  <a href="namespacehalo__communication__mod.html#a2b7d290453fe4d5d7cb784fdd7970227">More...</a><br /></td></tr>
<tr class="separator:a2b7d290453fe4d5d7cb784fdd7970227"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a655c6b0b626c430071abf774f6861840"><td class="memItemLeft" align="right" valign="top">integer function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a655c6b0b626c430071abf774f6861840">determine_halo_corner_size</a> (local_grid)</td></tr>
<tr class="memdesc:a655c6b0b626c430071abf774f6861840"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determine the halo corner size in elements.  <a href="namespacehalo__communication__mod.html#a655c6b0b626c430071abf774f6861840">More...</a><br /></td></tr>
<tr class="separator:a655c6b0b626c430071abf774f6861840"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00aa9edcba7108ca59856b7d5cb2c273"><td class="memItemLeft" align="right" valign="top">integer function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a00aa9edcba7108ca59856b7d5cb2c273">determine_halo_corner_element_sizes</a> (local_grid, pid)</td></tr>
<tr class="memdesc:a00aa9edcba7108ca59856b7d5cb2c273"><td class="mdescLeft">&#160;</td><td class="mdescRight">For a specific process id this determines the number of halo swap corner elements to involve in a communication.  <a href="namespacehalo__communication__mod.html#a00aa9edcba7108ca59856b7d5cb2c273">More...</a><br /></td></tr>
<tr class="separator:a00aa9edcba7108ca59856b7d5cb2c273"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67c8b944efbd7a4548ba73b96c1b5e5d"><td class="memItemLeft" align="right" valign="top">integer function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a67c8b944efbd7a4548ba73b96c1b5e5d">get_number_of_processes_involved_in_communication</a> (local_grid, my_rank, include_corners)</td></tr>
<tr class="memdesc:a67c8b944efbd7a4548ba73b96c1b5e5d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deduces the number of distinct neighbours that will be involved in a halo swap. This information is used to then allocate the appropriate amount of memory to store the neighbour halo swapping data structure.  <a href="namespacehalo__communication__mod.html#a67c8b944efbd7a4548ba73b96c1b5e5d">More...</a><br /></td></tr>
<tr class="separator:a67c8b944efbd7a4548ba73b96c1b5e5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c4471d526bafd49024cd360feeed138"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structcommunication__types__mod_1_1neighbour__description__type.html">neighbour_description_type</a>) function, dimension(number_distinct_neighbours)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a4c4471d526bafd49024cd360feeed138">populate_halo_swap_neighbours</a> (local_grid, my_rank, number_distinct_neighbours, involve_corners)</td></tr>
<tr class="memdesc:a4c4471d526bafd49024cd360feeed138"><td class="mdescLeft">&#160;</td><td class="mdescRight">Will populate the halo swap neighbour data strutures with appropriate neighbour pid and dimension numbers.  <a href="namespacehalo__communication__mod.html#a4c4471d526bafd49024cd360feeed138">More...</a><br /></td></tr>
<tr class="separator:a4c4471d526bafd49024cd360feeed138"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70a20bfed3126af2e0c9da0bca27b957"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a70a20bfed3126af2e0c9da0bca27b957">deduce_halo_pages_per_neighbour</a> (current_state, halo_swap_neighbours, number_distinct_neighbours, get_fields_per_halo_cell, fields_per_cell, halo_depth)</td></tr>
<tr class="memdesc:a70a20bfed3126af2e0c9da0bca27b957"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deduces the number of halo pages per neighbour halo swap and places this information in the appropriate data structures. We call a "page" of data the contiguous data of a field that we are going to send, such as halo 1 of w, halo 1 of zw and halo 2 of w (assuming these go to the same neighbour as 1)  <a href="namespacehalo__communication__mod.html#a70a20bfed3126af2e0c9da0bca27b957">More...</a><br /></td></tr>
<tr class="separator:a70a20bfed3126af2e0c9da0bca27b957"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbfc482aae9fcfa289e8fff653e8a714"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#afbfc482aae9fcfa289e8fff653e8a714">deduce_halo_corners_per_neighbour</a> (current_state, halo_swap_neighbours, number_distinct_neighbours, fields_per_cell)</td></tr>
<tr class="memdesc:afbfc482aae9fcfa289e8fff653e8a714"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines the number of halo corners to swap between specific neighours, this is similar to deducing the number of halo pages per neighbour, only it is for corners.  <a href="namespacehalo__communication__mod.html#afbfc482aae9fcfa289e8fff653e8a714">More...</a><br /></td></tr>
<tr class="separator:afbfc482aae9fcfa289e8fff653e8a714"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac05c8c755524caac5a4aacbcd37848e0"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#ac05c8c755524caac5a4aacbcd37848e0">allocate_halo_buffers_for_each_neighbour</a> (local_grid, number_distinct_neighbours, halo_swap_neighbours)</td></tr>
<tr class="memdesc:ac05c8c755524caac5a4aacbcd37848e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates the locally stored halo buffers (send and receive) for each neighbouring process.  <a href="namespacehalo__communication__mod.html#ac05c8c755524caac5a4aacbcd37848e0">More...</a><br /></td></tr>
<tr class="separator:ac05c8c755524caac5a4aacbcd37848e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65991d14beaafd48f7841ccc35be5e98"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a65991d14beaafd48f7841ccc35be5e98">generate_recv_field_buffer_matches</a> (current_state, halo_depth, cell_match)</td></tr>
<tr class="memdesc:a65991d14beaafd48f7841ccc35be5e98"><td class="mdescLeft">&#160;</td><td class="mdescRight">Precalculates the received buffer to field halo cell matches for each dimension and called from the initialisation stage.  <a href="namespacehalo__communication__mod.html#a65991d14beaafd48f7841ccc35be5e98">More...</a><br /></td></tr>
<tr class="separator:a65991d14beaafd48f7841ccc35be5e98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9537cebc6ed24d00aa7e34e6c66a9e29"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a9537cebc6ed24d00aa7e34e6c66a9e29">recv_all_halos</a> (current_state, halo_swap_state)</td></tr>
<tr class="memdesc:a9537cebc6ed24d00aa7e34e6c66a9e29"><td class="mdescLeft">&#160;</td><td class="mdescRight">Registers receive requests for all prognostic fields from the appropriate neighbouring processes (that we have already deduced in the initialisation stage.)  <a href="namespacehalo__communication__mod.html#a9537cebc6ed24d00aa7e34e6c66a9e29">More...</a><br /></td></tr>
<tr class="separator:a9537cebc6ed24d00aa7e34e6c66a9e29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e57e9753603d764609afb1f4cb2087b"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a0e57e9753603d764609afb1f4cb2087b">send_all_halos</a> (current_state, halo_swap_state, copy_fields_to_halo_buffer, copy_corner_fields_to_halo_buffer, source_data)</td></tr>
<tr class="memdesc:a0e57e9753603d764609afb1f4cb2087b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies all applicable bits of the prognostics into a send buffer for each neighbour and then issues asynchronous sends of this data.  <a href="namespacehalo__communication__mod.html#a0e57e9753603d764609afb1f4cb2087b">More...</a><br /></td></tr>
<tr class="separator:a0e57e9753603d764609afb1f4cb2087b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c46cf4c2f61bbbc70e2a86a2c6f741e"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a3c46cf4c2f61bbbc70e2a86a2c6f741e">copy_buffer_data_for_prognostics</a> (current_state, halo_swap_state, copy_halo_buffer_to_field, copy_halo_buffer_to_corner, source_data)</td></tr>
<tr class="memdesc:a3c46cf4c2f61bbbc70e2a86a2c6f741e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies the received data (held in buffers) from neighbours into the correct halo location in the prognostic fields.  <a href="namespacehalo__communication__mod.html#a3c46cf4c2f61bbbc70e2a86a2c6f741e">More...</a><br /></td></tr>
<tr class="separator:a3c46cf4c2f61bbbc70e2a86a2c6f741e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6146f7138547a3210839b478418856b"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#af6146f7138547a3210839b478418856b">perform_local_data_copy_for_corners</a> (my_rank, local_grid, field_data)</td></tr>
<tr class="memdesc:af6146f7138547a3210839b478418856b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a local data copy for corners when the neighbour is local (me)  <a href="namespacehalo__communication__mod.html#af6146f7138547a3210839b478418856b">More...</a><br /></td></tr>
<tr class="separator:af6146f7138547a3210839b478418856b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82ba20e03d4564be84a6186cfcebfc68"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a82ba20e03d4564be84a6186cfcebfc68">perform_local_data_copy_for_dimension</a> (dim, my_rank, halo_depth, local_grid, field_data)</td></tr>
<tr class="memdesc:a82ba20e03d4564be84a6186cfcebfc68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a local data copy for a specific dimension of a prognostic field.  <a href="namespacehalo__communication__mod.html#a82ba20e03d4564be84a6186cfcebfc68">More...</a><br /></td></tr>
<tr class="separator:a82ba20e03d4564be84a6186cfcebfc68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fb6163656e68853626d592e6d94cd5c"><td class="memItemLeft" align="right" valign="top">logical function, dimension(3)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a7fb6163656e68853626d592e6d94cd5c">retrieve_same_neighbour_information</a> (local_grid)</td></tr>
<tr class="memdesc:a7fb6163656e68853626d592e6d94cd5c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves whether we have the same neighbours for L and R halo swaps in each dimension.  <a href="namespacehalo__communication__mod.html#a7fb6163656e68853626d592e6d94cd5c">More...</a><br /></td></tr>
<tr class="separator:a7fb6163656e68853626d592e6d94cd5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4529b50fe46e332faf902bfa28144ae9"><td class="memItemLeft" align="right" valign="top">logical function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#a4529b50fe46e332faf902bfa28144ae9">has_pid_already_been_seen</a> (temp_neighbour_pids, pid)</td></tr>
<tr class="memdesc:a4529b50fe46e332faf902bfa28144ae9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns whether or not a specific process id has already been "seen" by searching a list of already seen process ids.  <a href="namespacehalo__communication__mod.html#a4529b50fe46e332faf902bfa28144ae9">More...</a><br /></td></tr>
<tr class="separator:a4529b50fe46e332faf902bfa28144ae9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0dc177b2189be5b8ed3877e6081e459"><td class="memItemLeft" align="right" valign="top">integer function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#ab0dc177b2189be5b8ed3877e6081e459">get_pid_neighbour_location</a> (halo_swap_neighbours, pid, number_distinct_neighbours)</td></tr>
<tr class="memdesc:ab0dc177b2189be5b8ed3877e6081e459"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given the process id of a neighbour this determines the location in the data structure of corresponding data for that. Note that this is an O(n) operation so ideally call once and reuse the results. If no process id is found then returns -1.  <a href="namespacehalo__communication__mod.html#ab0dc177b2189be5b8ed3877e6081e459">More...</a><br /></td></tr>
<tr class="separator:ab0dc177b2189be5b8ed3877e6081e459"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaff14692e79ef19796f8c6af98bc6ef9"><td class="memItemLeft" align="right" valign="top">integer function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehalo__communication__mod.html#aaff14692e79ef19796f8c6af98bc6ef9">get_single_field_per_halo_cell</a> (current_state)</td></tr>
<tr class="memdesc:aaff14692e79ef19796f8c6af98bc6ef9"><td class="mdescLeft">&#160;</td><td class="mdescRight">A very common function, which returns a single field per halo cell which is used to halo swap just one field.  <a href="namespacehalo__communication__mod.html#aaff14692e79ef19796f8c6af98bc6ef9">More...</a><br /></td></tr>
<tr class="separator:aaff14692e79ef19796f8c6af98bc6ef9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Provides the mechanism for halo swapping. This module contains the functionality required to determine what messages get sent where, pack data up en mass, send and receive from neighbouring processes and unpack into the appropriate data locations. There is also some functionality to help local copying of data to corresponding locations. The idea is that the caller will determine the policy (i.e. exactly what fields are to be communicated) through procedure arguments and this mechanism can be used again and again. It implements bulk sending of all field data in one large message to reduce communication overhead. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ac05c8c755524caac5a4aacbcd37848e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac05c8c755524caac5a4aacbcd37848e0">&#9670;&nbsp;</a></span>allocate_halo_buffers_for_each_neighbour()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine halo_communication_mod::allocate_halo_buffers_for_each_neighbour </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1local__grid__type.html">local_grid_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>local_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>number_distinct_neighbours</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1neighbour__description__type.html">neighbour_description_type</a>), dimension(:), intent(inout), allocatable&#160;</td>
          <td class="paramname"><em>halo_swap_neighbours</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocates the locally stored halo buffers (send and receive) for each neighbouring process. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">local_grid</td><td>Description of the local grid </td></tr>
    <tr><td class="paramname">halo_swap_neighbours</td><td>My neighbouring PIDs </td></tr>
    <tr><td class="paramname">number_distinct_neighbours</td><td>The number of distinct neighbours that I have </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00755">755</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordtype">type</span>(local_grid_type), <span class="keywordtype">intent(inout)</span> :: local_grid</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: number_distinct_neighbours</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="keywordtype">type</span>(neighbour_description_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">intent(inout)</span> :: &amp;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;         halo_swap_neighbours</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordtype">integer</span> :: i</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160; </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keywordflow">do</span> i=1,number_distinct_neighbours</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      <span class="keywordflow">if</span> (halo_swap_neighbours(i)%halo_pages .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;         <span class="comment">!depending on the direction of the swapping, the send and recv buffer size would change</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <span class="keyword">allocate</span>(halo_swap_neighbours(i)%send_halo_buffer(local_grid%size(z_index), &amp;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;             merge(local_grid%size(y_index), local_grid%size(x_index), &amp;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;             halo_swap_neighbours(i)%dimension==x_index), halo_swap_neighbours(i)%halo_pages))</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <span class="keyword">allocate</span>(halo_swap_neighbours(i)%recv_halo_buffer(local_grid%size(z_index), &amp;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;             merge(local_grid%size(y_index), local_grid%size(x_index), &amp;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;             halo_swap_neighbours(i)%dimension==x_index), halo_swap_neighbours(i)%halo_pages))</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <span class="keywordflow">if</span> (halo_swap_neighbours(i)%halo_corners .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;         <span class="comment">! is 4 because of the 4 cells to swap since the halo_depth is 2(2 in x and 2 in y)??</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="keyword">allocate</span>(halo_swap_neighbours(i)%send_corner_buffer(local_grid%size(z_index), 4, &amp;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;             halo_swap_neighbours(i)%halo_corners))</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <span class="keyword">allocate</span>(halo_swap_neighbours(i)%recv_corner_buffer(local_grid%size(z_index), 4, &amp;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;             halo_swap_neighbours(i)%halo_corners))</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="keywordflow">    end do</span>    </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_ac05c8c755524caac5a4aacbcd37848e0_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_ac05c8c755524caac5a4aacbcd37848e0_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_ac05c8c755524caac5a4aacbcd37848e0_icgraph" id="anamespacehalo__communication__mod_ac05c8c755524caac5a4aacbcd37848e0_icgraph">
<area shape="rect" title="Allocates the locally stored halo buffers (send and receive) for each neighbouring process." alt="" coords="481,20,669,76"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ac287e4b520fd9a75f35e58e67ec52880" title="Initialises a halo swapping state, by determining the neighbours, size of data in each swap and alloc..." alt="" coords="231,27,433,69"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="a0a11eeeaa1e80eab180fb8652ce592a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a11eeeaa1e80eab180fb8652ce592a6">&#9670;&nbsp;</a></span>blocking_halo_swap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public halo_communication_mod::blocking_halo_swap </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1halo__communication__type.html">halo_communication_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>halo_swap_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1copy__fields__to__halo__buffer__proc__interface.html">copy_fields_to_halo_buffer_proc_interface</a>)&#160;</td>
          <td class="paramname"><em>copy_to_halo_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html">perform_local_data_copy_proc_interface</a>)&#160;</td>
          <td class="paramname"><em>perform_local_data_copy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1copy__halo__buffer__to__field__proc__interface.html">copy_halo_buffer_to_field_proc_interface</a>)&#160;</td>
          <td class="paramname"><em>copy_from_halo_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1copy__corners__to__halo__buffer__proc__interface.html">copy_corners_to_halo_buffer_proc_interface</a>), optional&#160;</td>
          <td class="paramname"><em>copy_corners_to_halo_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1copy__halo__buffer__to__corner__proc__interface.html">copy_halo_buffer_to_corner_proc_interface</a>), optional&#160;</td>
          <td class="paramname"><em>copy_from_halo_buffer_to_corner</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1field__data__wrapper__type.html">field_data_wrapper_type</a>), dimension(:), intent(in), optional&#160;</td>
          <td class="paramname"><em>source_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs the entire halo swap operation, this is simply a wrapper around the nonblocking initiate and complete procedures and saves the programmer from calling these directly if they do not wish to interleave any computation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
    <tr><td class="paramname">halo_swap_state</td><td>The halo swapping state </td></tr>
    <tr><td class="paramname">copy_to_halo_buffer</td><td>Procedure pointer which is called to copy the data into the halo send buffer </td></tr>
    <tr><td class="paramname">perform_local_data_copy</td><td>Procedure pointer which performs local data copying (where the neighbour is the local process) </td></tr>
    <tr><td class="paramname">copy_from_halo_buffer</td><td>Procedure pointer which copies received data from the halo buffer into the field </td></tr>
    <tr><td class="paramname">copy_corners_to_halo_buffer</td><td>Optional procedure pointer which copies data in corners to the halo send buffer </td></tr>
    <tr><td class="paramname">copy_from_halo_buffer_to_corner</td><td>Optional procedure pointer which copies received data into halo corners </td></tr>
    <tr><td class="paramname">source_data</td><td>Optional source data which is read from into send buffers and written into by receieve buffers </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00109">109</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordtype">type</span>(halo_communication_type), <span class="keywordtype">intent(inout)</span> :: halo_swap_state</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordtype">procedure</span>(copy_fields_to_halo_buffer_proc_interface) :: copy_to_halo_buffer</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordtype">procedure</span>(copy_halo_buffer_to_field_proc_interface) :: copy_from_halo_buffer</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordtype">procedure</span>(perform_local_data_copy_proc_interface) :: perform_local_data_copy</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordtype">procedure</span>(copy_corners_to_halo_buffer_proc_interface), <span class="keywordtype">optional</span> :: &amp;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;         copy_corners_to_halo_buffer</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordtype">procedure</span>(copy_halo_buffer_to_corner_proc_interface), <span class="keywordtype">optional</span> :: &amp;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;         copy_from_halo_buffer_to_corner</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordtype">type</span>(field_data_wrapper_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: source_data</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">if</span> ((<span class="keyword">present</span>(copy_corners_to_halo_buffer) .and. .not. &amp;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;         <span class="keyword">present</span>(copy_from_halo_buffer_to_corner)) .or. &amp;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;         (.not. <span class="keyword">present</span>(copy_corners_to_halo_buffer) .and. &amp;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;         <span class="keyword">present</span>(copy_from_halo_buffer_to_corner))) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;You must either provie no or both corner optional arguments to the halo swap function&quot;</span>)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(source_data)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;       <span class="keywordflow">if</span> (<span class="keyword">present</span>(copy_corners_to_halo_buffer)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;          <span class="keyword">call </span>initiate_nonblocking_halo_swap(current_state, halo_swap_state, &amp;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;               copy_to_halo_buffer, copy_corners_to_halo_buffer, source_data)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;       <span class="keywordflow">else</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;          <span class="keyword">call </span>initiate_nonblocking_halo_swap(current_state, halo_swap_state, &amp;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;               copy_to_halo_buffer, source_data=source_data)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">present</span>(copy_from_halo_buffer_to_corner)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;         <span class="keyword">call </span>complete_nonblocking_halo_swap(current_state, halo_swap_state, &amp;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;              perform_local_data_copy, copy_from_halo_buffer, copy_from_halo_buffer_to_corner, &amp;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;              source_data)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keyword">call </span>complete_nonblocking_halo_swap(current_state, halo_swap_state, &amp;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;             perform_local_data_copy, copy_from_halo_buffer, source_data=source_data)</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="keywordflow">      end if</span>      </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">present</span>(copy_corners_to_halo_buffer)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keyword">call </span>initiate_nonblocking_halo_swap(current_state, halo_swap_state, copy_to_halo_buffer,&amp;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;             copy_corners_to_halo_buffer)</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keyword">call </span>initiate_nonblocking_halo_swap(current_state, halo_swap_state, copy_to_halo_buffer)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">present</span>(copy_from_halo_buffer_to_corner)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;         <span class="keyword">call </span>complete_nonblocking_halo_swap(current_state, halo_swap_state, &amp;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;              perform_local_data_copy, &amp;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;             copy_from_halo_buffer, copy_from_halo_buffer_to_corner)</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keyword">call </span>complete_nonblocking_halo_swap(current_state, halo_swap_state, &amp;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;             perform_local_data_copy, copy_from_halo_buffer)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="keywordflow">      end if</span>      </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keywordflow">    end if</span>    </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a0a11eeeaa1e80eab180fb8652ce592a6_cgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a0a11eeeaa1e80eab180fb8652ce592a6_cgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a0a11eeeaa1e80eab180fb8652ce592a6_cgraph" id="anamespacehalo__communication__mod_a0a11eeeaa1e80eab180fb8652ce592a6_cgraph">
<area shape="rect" title="Performs the entire halo swap operation, this is simply a wrapper around the nonblocking initiate and..." alt="" coords="5,147,183,188"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a02b04565afda3dc93273a16944a2976e" title="This completes a nonblocking halo swap and it is only during this call that the data fields themselve..." alt="" coords="231,139,420,195"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="476,215,619,242"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a8dac8c6529d0169c9e4402690f62d581" title="Initiates a non blocking halo swap, this registers the receive requests, copies data into the send bu..." alt="" coords="238,59,413,115"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a3c46cf4c2f61bbbc70e2a86a2c6f741e" title="Copies the received data (held in buffers) from neighbours into the correct halo location in the prog..." alt="" coords="468,135,627,191"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ab0dc177b2189be5b8ed3877e6081e459" title="Given the process id of a neighbour this determines the location in the data structure of correspondi..." alt="" coords="675,97,841,153"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="675,208,841,249"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a9537cebc6ed24d00aa7e34e6c66a9e29" title="Registers receive requests for all prognostic fields from the appropriate neighbouring processes (tha..." alt="" coords="476,5,619,47"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a0e57e9753603d764609afb1f4cb2087b" title="Copies all applicable bits of the prognostics into a send buffer for each neighbour and then issues a..." alt="" coords="474,71,621,112"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a0a11eeeaa1e80eab180fb8652ce592a6_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a0a11eeeaa1e80eab180fb8652ce592a6_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a0a11eeeaa1e80eab180fb8652ce592a6_icgraph" id="anamespacehalo__communication__mod_a0a11eeeaa1e80eab180fb8652ce592a6_icgraph">
<area shape="rect" title="Performs the entire halo swap operation, this is simply a wrapper around the nonblocking initiate and..." alt="" coords="231,27,408,69"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="a02b04565afda3dc93273a16944a2976e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02b04565afda3dc93273a16944a2976e">&#9670;&nbsp;</a></span>complete_nonblocking_halo_swap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public halo_communication_mod::complete_nonblocking_halo_swap </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1halo__communication__type.html">halo_communication_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>halo_swap_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html">perform_local_data_copy_proc_interface</a>)&#160;</td>
          <td class="paramname"><em>perform_local_data_copy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1copy__halo__buffer__to__field__proc__interface.html">copy_halo_buffer_to_field_proc_interface</a>)&#160;</td>
          <td class="paramname"><em>copy_from_halo_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1copy__halo__buffer__to__corner__proc__interface.html">copy_halo_buffer_to_corner_proc_interface</a>), optional&#160;</td>
          <td class="paramname"><em>copy_from_halo_buffer_to_corner</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1field__data__wrapper__type.html">field_data_wrapper_type</a>), dimension(:), intent(in), optional&#160;</td>
          <td class="paramname"><em>source_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This completes a nonblocking halo swap and it is only during this call that the data fields themselves are modified. This will perform local data copying, wait for all outstanding receives to complete, copy the received buffer data into the data and then wait for all outstanding sends to complete. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
    <tr><td class="paramname">halo_swap_state</td><td>The halo swapping state </td></tr>
    <tr><td class="paramname">perform_local_data_copy</td><td>Procedure pointer which performs local data copying (where the neighbour is the local process) </td></tr>
    <tr><td class="paramname">copy_from_halo_buffer</td><td>Procedure pointer which copies received data from the halo buffer into the field </td></tr>
    <tr><td class="paramname">copy_from_halo_buffer_to_corner</td><td>Optional procedure pointer which copies halo data into field corners </td></tr>
    <tr><td class="paramname">source_data</td><td>Optional source data which is read from into send buffers and written into by receieve buffers </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00179">179</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordtype">type</span>(halo_communication_type), <span class="keywordtype">intent(inout)</span> :: halo_swap_state</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordtype">procedure</span>(copy_halo_buffer_to_field_proc_interface) :: copy_from_halo_buffer</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordtype">procedure</span>(perform_local_data_copy_proc_interface) :: perform_local_data_copy</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordtype">procedure</span>(copy_halo_buffer_to_corner_proc_interface), <span class="keywordtype">optional</span> :: &amp;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;         copy_from_halo_buffer_to_corner</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordtype">type</span>(field_data_wrapper_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: source_data</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordtype">integer</span> :: ierr</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">if</span> ((<span class="keyword">present</span>(copy_from_halo_buffer_to_corner) .and. .not. halo_swap_state%involve_corners) &amp;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;         .or. (.not. <span class="keyword">present</span>(copy_from_halo_buffer_to_corner) .and. &amp;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;         halo_swap_state%involve_corners)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#a10e28447dd10ef9f92d205bc98fb26d3">log_warn</a>, <span class="stringliteral">&quot;Inconsistent halo swap corner state and corner subroutine call arguments&quot;</span>)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="keywordflow">    end if</span>    </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(source_data)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keyword">call </span>perform_local_data_copy(current_state, halo_swap_state%halo_depth, &amp;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;           halo_swap_state%involve_corners, source_data)</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keyword">call </span>perform_local_data_copy(current_state, halo_swap_state%halo_depth, &amp;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;           halo_swap_state%involve_corners)</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span> (halo_swap_state%number_distinct_neighbours .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <span class="keyword">call </span>mpi_waitall(<span class="keyword">size</span>(halo_swap_state%recv_requests), halo_swap_state%recv_requests, &amp;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;           mpi_statuses_ignore, ierr)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">present</span>(source_data)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordflow">if</span> (halo_swap_state%involve_corners .and. <span class="keyword">present</span>(copy_from_halo_buffer_to_corner)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;          <span class="keyword">call </span>copy_buffer_data_for_prognostics(current_state, halo_swap_state, &amp;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;               copy_from_halo_buffer, copy_from_halo_buffer_to_corner, source_data)</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;          <span class="keyword">call </span>copy_buffer_data_for_prognostics(current_state, halo_swap_state, &amp;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;               copy_from_halo_buffer, source_data=source_data)</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">if</span> (halo_swap_state%involve_corners .and. <span class="keyword">present</span>(copy_from_halo_buffer_to_corner)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;          <span class="keyword">call </span>copy_buffer_data_for_prognostics(current_state, halo_swap_state, &amp;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;               copy_from_halo_buffer, copy_from_halo_buffer_to_corner)</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;          <span class="keyword">call </span>copy_buffer_data_for_prognostics(current_state, halo_swap_state, &amp;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;               copy_from_halo_buffer)</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="keyword">call </span>mpi_waitall(<span class="keyword">size</span>(halo_swap_state%send_requests), halo_swap_state%send_requests, &amp;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;           mpi_statuses_ignore, ierr)</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    halo_swap_state%swap_in_progress=.false.</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a02b04565afda3dc93273a16944a2976e_cgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a02b04565afda3dc93273a16944a2976e_cgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a02b04565afda3dc93273a16944a2976e_cgraph" id="anamespacehalo__communication__mod_a02b04565afda3dc93273a16944a2976e_cgraph">
<area shape="rect" title="This completes a nonblocking halo swap and it is only during this call that the data fields themselve..." alt="" coords="5,43,195,99"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a3c46cf4c2f61bbbc70e2a86a2c6f741e" title="Copies the received data (held in buffers) from neighbours into the correct halo location in the prog..." alt="" coords="243,8,401,64"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="251,89,393,116"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ab0dc177b2189be5b8ed3877e6081e459" title="Given the process id of a neighbour this determines the location in the data structure of correspondi..." alt="" coords="450,5,615,61"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="449,85,616,126"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a02b04565afda3dc93273a16944a2976e_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a02b04565afda3dc93273a16944a2976e_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a02b04565afda3dc93273a16944a2976e_icgraph" id="anamespacehalo__communication__mod_a02b04565afda3dc93273a16944a2976e_icgraph">
<area shape="rect" title="This completes a nonblocking halo swap and it is only during this call that the data fields themselve..." alt="" coords="456,27,645,83"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a0a11eeeaa1e80eab180fb8652ce592a6" title="Performs the entire halo swap operation, this is simply a wrapper around the nonblocking initiate and..." alt="" coords="231,5,408,47"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,13,183,98"/>
</map>
</div>

</div>
</div>
<a id="a3c46cf4c2f61bbbc70e2a86a2c6f741e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c46cf4c2f61bbbc70e2a86a2c6f741e">&#9670;&nbsp;</a></span>copy_buffer_data_for_prognostics()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine halo_communication_mod::copy_buffer_data_for_prognostics </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1halo__communication__type.html">halo_communication_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>halo_swap_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1copy__halo__buffer__to__field__proc__interface.html">copy_halo_buffer_to_field_proc_interface</a>)&#160;</td>
          <td class="paramname"><em>copy_halo_buffer_to_field</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1copy__halo__buffer__to__corner__proc__interface.html">copy_halo_buffer_to_corner_proc_interface</a>), optional&#160;</td>
          <td class="paramname"><em>copy_halo_buffer_to_corner</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1field__data__wrapper__type.html">field_data_wrapper_type</a>), dimension(:), intent(in), optional&#160;</td>
          <td class="paramname"><em>source_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Copies the received data (held in buffers) from neighbours into the correct halo location in the prognostic fields. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
    <tr><td class="paramname">halo_swap_state</td><td>The halo swapping state </td></tr>
    <tr><td class="paramname">copy_halo_buffer_to_field</td><td>Procedure pointer which copies the halo buffer into the data field </td></tr>
    <tr><td class="paramname">copy_halo_buffer_to_corner</td><td>Optional procedure pointer to copy halo buffer into field corners </td></tr>
    <tr><td class="paramname">source_data</td><td>Optional source data which is read from into send buffers and written into by receieve buffers </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00969">969</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordtype">type</span>(halo_communication_type), <span class="keywordtype">intent(inout)</span> :: halo_swap_state</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordtype">procedure</span>(copy_halo_buffer_to_field_proc_interface) :: copy_halo_buffer_to_field</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordtype">procedure</span>(copy_halo_buffer_to_corner_proc_interface), <span class="keywordtype">optional</span> :: copy_halo_buffer_to_corner</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="keywordtype">type</span>(field_data_wrapper_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: source_data</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordtype">integer</span> :: i, j, hstart, hend, pid_location, target_index, x_target_index, &amp;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;         y_target_index, current_page(halo_swap_state%number_distinct_neighbours)</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160; </div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    hstart=merge(2, 1, halo_swap_state%halo_depth==1)</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    hend=merge(3, 4, halo_swap_state%halo_depth==1)</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160; </div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    current_page(:)=1</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="keywordflow">do</span> i=2, 3</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      <span class="keywordflow">do</span> j=hstart, hend</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <span class="keywordflow">if</span> (current_state%parallel%my_rank .ne. current_state%local_grid%neighbours(i,j)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;          <span class="keywordflow">if</span> (j==halo_swap_state%cell_match(i, 1)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;            target_index=1</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j==halo_swap_state%cell_match(i, 2)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            target_index=2</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j==halo_swap_state%cell_match(i, 3)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;            target_index=current_state%local_grid%local_domain_end_index(i)+1</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j==halo_swap_state%cell_match(i, 4)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;            target_index=current_state%local_grid%local_domain_end_index(i)+2</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;          pid_location=get_pid_neighbour_location(halo_swap_state%halo_swap_neighbours, &amp;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;               current_state%local_grid%neighbours(i,j),&amp;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;               halo_swap_state%number_distinct_neighbours)</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">present</span>(source_data)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            <span class="keyword">call </span>copy_halo_buffer_to_field(current_state, &amp;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                 halo_swap_state%halo_swap_neighbours(pid_location), i, target_index,&amp;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                 pid_location, current_page, source_data)</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            <span class="keyword">call </span>copy_halo_buffer_to_field(current_state, &amp;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                 halo_swap_state%halo_swap_neighbours(pid_location), i, target_index,&amp;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                 pid_location, current_page)</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(copy_halo_buffer_to_corner)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      current_page(:)=1</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;      <span class="keywordflow">do</span> j=<span class="keyword">size</span>(current_state%local_grid%corner_neighbours, 1),1,-1</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <span class="keywordflow">if</span> (current_state%parallel%my_rank .ne. &amp;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;             current_state%local_grid%corner_neighbours(j,1)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;          x_target_index=merge(2, current_state%local_grid%local_domain_end_index(x_index)+1,&amp;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;               j==1 .or. j==3)</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;          y_target_index=merge(2, current_state%local_grid%local_domain_end_index(y_index)+1, &amp;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;               j==1 .or. j==2)</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;          pid_location=get_pid_neighbour_location(halo_swap_state%halo_swap_neighbours, &amp;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;               current_state%local_grid%corner_neighbours(j,1), &amp;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;               halo_swap_state%number_distinct_neighbours)</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">present</span>(source_data)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;            <span class="keyword">call </span>copy_halo_buffer_to_corner(current_state, &amp;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                 halo_swap_state%halo_swap_neighbours(pid_location), j, &amp;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                 x_target_index, y_target_index, pid_location, current_page, source_data)</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;            <span class="keyword">call </span>copy_halo_buffer_to_corner(current_state, &amp;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                 halo_swap_state%halo_swap_neighbours(pid_location), j, &amp;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                 x_target_index, y_target_index, pid_location, current_page)</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a3c46cf4c2f61bbbc70e2a86a2c6f741e_cgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a3c46cf4c2f61bbbc70e2a86a2c6f741e_cgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a3c46cf4c2f61bbbc70e2a86a2c6f741e_cgraph" id="anamespacehalo__communication__mod_a3c46cf4c2f61bbbc70e2a86a2c6f741e_cgraph">
<area shape="rect" title="Copies the received data (held in buffers) from neighbours into the correct halo location in the prog..." alt="" coords="5,5,164,61"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ab0dc177b2189be5b8ed3877e6081e459" title="Given the process id of a neighbour this determines the location in the data structure of correspondi..." alt="" coords="212,5,377,61"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a3c46cf4c2f61bbbc70e2a86a2c6f741e_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a3c46cf4c2f61bbbc70e2a86a2c6f741e_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a3c46cf4c2f61bbbc70e2a86a2c6f741e_icgraph" id="anamespacehalo__communication__mod_a3c46cf4c2f61bbbc70e2a86a2c6f741e_icgraph">
<area shape="rect" title="Copies the received data (held in buffers) from neighbours into the correct halo location in the prog..." alt="" coords="693,27,852,83"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a02b04565afda3dc93273a16944a2976e" title="This completes a nonblocking halo swap and it is only during this call that the data fields themselve..." alt="" coords="456,27,645,83"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a0a11eeeaa1e80eab180fb8652ce592a6" title="Performs the entire halo swap operation, this is simply a wrapper around the nonblocking initiate and..." alt="" coords="231,5,408,47"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,13,183,98"/>
</map>
</div>

</div>
</div>
<a id="a40d0a9734a3909fce7b6648cb6f7232f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40d0a9734a3909fce7b6648cb6f7232f">&#9670;&nbsp;</a></span>copy_buffer_to_corner()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public halo_communication_mod::copy_buffer_to_corner </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1local__grid__type.html">local_grid_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>local_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>halo_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>field_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>corner_loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>x_target_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>y_target_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>halo_page</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies the received buffer for a specific field to the corresponding corner of that field. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">local_grid</td><td>Description of the local grid </td></tr>
    <tr><td class="paramname">halo_buffer</td><td>Raw halo buffer data </td></tr>
    <tr><td class="paramname">field_data</td><td>Raw prognostic field data </td></tr>
    <tr><td class="paramname">corner_loc</td><td>Location of the corner </td></tr>
    <tr><td class="paramname">x_target_index</td><td>The X target index that we copy into </td></tr>
    <tr><td class="paramname">y_target_index</td><td>The Y target index that we copy into </td></tr>
    <tr><td class="paramname">halo_page</td><td>The halo page to read from </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00366">366</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordtype">type</span>(local_grid_type), <span class="keywordtype">intent(inout)</span> :: local_grid</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: corner_loc, x_target_index, y_target_index, halo_page</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: halo_buffer</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: field_data</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;         local_grid%local_domain_end_index(z_index),&amp;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;         y_target_index, x_target_index)=halo_buffer(:,4,halo_page)</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;         local_grid%local_domain_end_index(z_index),&amp;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;         merge(y_target_index-1, y_target_index+1, corner_loc .lt. 3), x_target_index)=&amp;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;         halo_buffer(:,3,halo_page)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;         local_grid%local_domain_end_index(z_index),&amp;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;         y_target_index, merge(x_target_index-1, x_target_index+1, corner_loc == 1 .or.&amp;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;         corner_loc == 3))= halo_buffer(:,2,halo_page)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;         local_grid%local_domain_end_index(z_index),&amp;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;         merge(y_target_index-1, y_target_index+1, corner_loc .lt. 3), &amp;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;         merge(x_target_index-1, x_target_index+1, corner_loc == 1 .or.&amp;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;         corner_loc == 3))= halo_buffer(:,1,halo_page)    </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a40d0a9734a3909fce7b6648cb6f7232f_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a40d0a9734a3909fce7b6648cb6f7232f_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a40d0a9734a3909fce7b6648cb6f7232f_icgraph" id="anamespacehalo__communication__mod_a40d0a9734a3909fce7b6648cb6f7232f_icgraph">
<area shape="rect" title="Copies the received buffer for a specific field to the corresponding corner of that field." alt="" coords="231,20,375,76"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="af69a6efcccb7091a6735135bb468c765"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af69a6efcccb7091a6735135bb468c765">&#9670;&nbsp;</a></span>copy_buffer_to_field()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public halo_communication_mod::copy_buffer_to_field </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1local__grid__type.html">local_grid_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>local_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>halo_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>field_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>target_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>halo_page</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies the received buffer for a specific field to the corresponding halo data of that prognostic field. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">local_grid</td><td>Description of the local grid </td></tr>
    <tr><td class="paramname">halo_buffer</td><td>Raw halo buffer data </td></tr>
    <tr><td class="paramname">field_data</td><td>Raw prognostic field data </td></tr>
    <tr><td class="paramname">dim</td><td>The dimension to copy into </td></tr>
    <tr><td class="paramname">target_index</td><td>The target index in the dimension that we copy into </td></tr>
    <tr><td class="paramname">halo_page</td><td>The halo page to read from </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00399">399</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordtype">type</span>(local_grid_type), <span class="keywordtype">intent(inout)</span> :: local_grid</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: dim, target_index, halo_page</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: halo_buffer</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: field_data</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="comment">! If the neighbours are the same then reverse our placement of the data due to wrapping</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="comment">! around and order of</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="comment">! messages being sent. This is not an issue if the neighbours are different    </span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">if</span> (dim == x_index) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;           local_grid%local_domain_end_index(z_index),&amp;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;           local_grid%local_domain_start_index(y_index):&amp;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;           local_grid%local_domain_end_index(y_index), &amp;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;           target_index) = halo_buffer(:,:,halo_page)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;           local_grid%local_domain_end_index(z_index), target_index, &amp;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;           local_grid%local_domain_start_index(x_index):&amp;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;           local_grid%local_domain_end_index(x_index)) = &amp;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;           halo_buffer(:,:,halo_page)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_af69a6efcccb7091a6735135bb468c765_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_af69a6efcccb7091a6735135bb468c765_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_af69a6efcccb7091a6735135bb468c765_icgraph" id="anamespacehalo__communication__mod_af69a6efcccb7091a6735135bb468c765_icgraph">
<area shape="rect" title="Copies the received buffer for a specific field to the corresponding halo data of that prognostic fie..." alt="" coords="231,27,405,69"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="aef632552711c3ad468d0bbcc320fd238"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef632552711c3ad468d0bbcc320fd238">&#9670;&nbsp;</a></span>copy_corner_to_buffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public halo_communication_mod::copy_corner_to_buffer </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1local__grid__type.html">local_grid_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>local_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>halo_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>field_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>corner_loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>x_source_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>y_source_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>halo_page</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies prognostic field corner data to send buffer for specific field. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">local_grid</td><td>Description of the local grid </td></tr>
    <tr><td class="paramname">halo_buffer</td><td>Raw halo_buffer data that is written to </td></tr>
    <tr><td class="paramname">field_data</td><td>Raw prognostic field data that is read from </td></tr>
    <tr><td class="paramname">corner_loc</td><td>Location of the corner </td></tr>
    <tr><td class="paramname">x_source_index</td><td>The X index in the read dimension </td></tr>
    <tr><td class="paramname">y_source_index</td><td>The Y index in the read dimension </td></tr>
    <tr><td class="paramname">halo_page</td><td>The halo buffer page to write to </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00459">459</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordtype">type</span>(local_grid_type), <span class="keywordtype">intent(inout)</span> :: local_grid</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: corner_loc, x_source_index, y_source_index, halo_page</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: halo_buffer</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: field_data</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="comment">!! TODO: hardcoded size of the corners</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    halo_buffer(:,1,halo_page) = field_data(:,y_source_index,x_source_index)</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    halo_buffer(:,2,halo_page) = field_data(:, merge(y_source_index-1, y_source_index+1,   &amp;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;         corner_loc .lt. 3), x_source_index)</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    halo_buffer(:,3,halo_page) = field_data(:, y_source_index,                             &amp;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;         merge(x_source_index-1,x_source_index+1, corner_loc == 1 .or. corner_loc == 3))</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    halo_buffer(:,4,halo_page) = field_data(:, merge(y_source_index-1, y_source_index+1,   &amp;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;         corner_loc .lt. 3), merge(x_source_index-1,x_source_index+1, corner_loc == 1 .or. &amp;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;         corner_loc == 3))</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_aef632552711c3ad468d0bbcc320fd238_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_aef632552711c3ad468d0bbcc320fd238_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_aef632552711c3ad468d0bbcc320fd238_icgraph" id="anamespacehalo__communication__mod_aef632552711c3ad468d0bbcc320fd238_icgraph">
<area shape="rect" title="Copies prognostic field corner data to send buffer for specific field." alt="" coords="231,20,379,76"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="a213c2f386f6a61af7053b74d9c3babbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a213c2f386f6a61af7053b74d9c3babbb">&#9670;&nbsp;</a></span>copy_field_to_buffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public halo_communication_mod::copy_field_to_buffer </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1local__grid__type.html">local_grid_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>local_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>halo_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>field_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>source_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>halo_page</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies prognostic field data to send buffer for specific field, dimension, halo cell. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">local_grid</td><td>Description of the local grid </td></tr>
    <tr><td class="paramname">halo_buffer</td><td>Raw halo_buffer data that is written to </td></tr>
    <tr><td class="paramname">field_data</td><td>Raw prognostic field data that is read from </td></tr>
    <tr><td class="paramname">dim</td><td>Dimension that we are reading from </td></tr>
    <tr><td class="paramname">source_index</td><td>The index in the read dimension </td></tr>
    <tr><td class="paramname">halo_page</td><td>The halo buffer page to write to </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00431">431</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordtype">type</span>(local_grid_type), <span class="keywordtype">intent(inout)</span> :: local_grid</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: dim, source_index, halo_page</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: halo_buffer</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: field_data</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">if</span> (dim == x_index) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;       halo_buffer(:,:,halo_page) = field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            local_grid%local_domain_end_index(z_index), &amp;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            local_grid%local_domain_start_index(y_index):&amp;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            local_grid%local_domain_end_index(y_index), source_index)</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;       halo_buffer(:,:,halo_page)=field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            local_grid%local_domain_end_index(z_index), source_index, &amp;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            local_grid%local_domain_start_index(x_index):&amp;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            local_grid%local_domain_end_index(x_index))</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a213c2f386f6a61af7053b74d9c3babbb_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a213c2f386f6a61af7053b74d9c3babbb_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a213c2f386f6a61af7053b74d9c3babbb_icgraph" id="anamespacehalo__communication__mod_a213c2f386f6a61af7053b74d9c3babbb_icgraph">
<area shape="rect" title="Copies prognostic field data to send buffer for specific field, dimension, halo cell." alt="" coords="231,20,372,76"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="afbfc482aae9fcfa289e8fff653e8a714"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afbfc482aae9fcfa289e8fff653e8a714">&#9670;&nbsp;</a></span>deduce_halo_corners_per_neighbour()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine halo_communication_mod::deduce_halo_corners_per_neighbour </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1neighbour__description__type.html">neighbour_description_type</a>), dimension(:), allocatable&#160;</td>
          <td class="paramname"><em>halo_swap_neighbours</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>number_distinct_neighbours</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>fields_per_cell</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determines the number of halo corners to swap between specific neighours, this is similar to deducing the number of halo pages per neighbour, only it is for corners. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
    <tr><td class="paramname">halo_swap_neighbours</td><td>Description of neighbouring halo swap state </td></tr>
    <tr><td class="paramname">number_distinct_neighbours</td><td>The number of distinct neighbours that I swap with </td></tr>
    <tr><td class="paramname">fields_per_cell</td><td>The number of fields per cell is written into here </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00730">730</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordtype">type</span>(neighbour_description_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: halo_swap_neighbours</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: number_distinct_neighbours, fields_per_cell</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordtype">integer</span> :: i, j, pid_location</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="comment">! i moves in x ,j in y</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="keywordflow">do</span> i=1,<span class="keyword">size</span>(current_state%local_grid%corner_neighbours, 2)</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="keywordflow">do</span> j=1,<span class="keyword">size</span>(current_state%local_grid%corner_neighbours, 1)</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="keywordflow">if</span> (current_state%parallel%my_rank .ne. &amp;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;             current_state%local_grid%corner_neighbours(j,i)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;           pid_location = get_pid_neighbour_location(halo_swap_neighbours, &amp;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                current_state%local_grid%corner_neighbours(j,i), number_distinct_neighbours)</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;           halo_swap_neighbours(pid_location)%halo_corners = &amp;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                halo_swap_neighbours(pid_location)%halo_corners + fields_per_cell</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="keywordflow">        end if</span>        </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="keywordflow">      end do</span>      </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="keywordflow">    end do</span>    </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_afbfc482aae9fcfa289e8fff653e8a714_cgraph.png" border="0" usemap="#anamespacehalo__communication__mod_afbfc482aae9fcfa289e8fff653e8a714_cgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_afbfc482aae9fcfa289e8fff653e8a714_cgraph" id="anamespacehalo__communication__mod_afbfc482aae9fcfa289e8fff653e8a714_cgraph">
<area shape="rect" title="Determines the number of halo corners to swap between specific neighours, this is similar to deducing..." alt="" coords="5,5,188,61"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ab0dc177b2189be5b8ed3877e6081e459" title="Given the process id of a neighbour this determines the location in the data structure of correspondi..." alt="" coords="236,5,401,61"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_afbfc482aae9fcfa289e8fff653e8a714_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_afbfc482aae9fcfa289e8fff653e8a714_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_afbfc482aae9fcfa289e8fff653e8a714_icgraph" id="anamespacehalo__communication__mod_afbfc482aae9fcfa289e8fff653e8a714_icgraph">
<area shape="rect" title="Determines the number of halo corners to swap between specific neighours, this is similar to deducing..." alt="" coords="481,20,664,76"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ac287e4b520fd9a75f35e58e67ec52880" title="Initialises a halo swapping state, by determining the neighbours, size of data in each swap and alloc..." alt="" coords="231,27,433,69"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="a70a20bfed3126af2e0c9da0bca27b957"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70a20bfed3126af2e0c9da0bca27b957">&#9670;&nbsp;</a></span>deduce_halo_pages_per_neighbour()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine halo_communication_mod::deduce_halo_pages_per_neighbour </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1neighbour__description__type.html">neighbour_description_type</a>), dimension(:), allocatable&#160;</td>
          <td class="paramname"><em>halo_swap_neighbours</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>number_distinct_neighbours</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1get__fields__per__halo__cell__proc__interface.html">get_fields_per_halo_cell_proc_interface</a>)&#160;</td>
          <td class="paramname"><em>get_fields_per_halo_cell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>fields_per_cell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>halo_depth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Deduces the number of halo pages per neighbour halo swap and places this information in the appropriate data structures. We call a "page" of data the contiguous data of a field that we are going to send, such as halo 1 of w, halo 1 of zw and halo 2 of w (assuming these go to the same neighbour as 1) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
    <tr><td class="paramname">halo_swap_neighbours</td><td>My neighbouring PIDs </td></tr>
    <tr><td class="paramname">number_distinct_neighbours</td><td>The number of distinct neighbours that I have </td></tr>
    <tr><td class="paramname">get_fields_per_halo_cell</td><td>Procedure pointer to get the number of fields per halo cell </td></tr>
    <tr><td class="paramname">fields_per_cell</td><td>The number of fields per cell is written into here </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00696">696</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordtype">type</span>(neighbour_description_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: halo_swap_neighbours</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: number_distinct_neighbours, halo_depth</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordtype">procedure</span>(get_fields_per_halo_cell_proc_interface) :: get_fields_per_halo_cell</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: fields_per_cell</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordtype">integer</span> :: i, j, pid_location, halo_start, halo_end</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    fields_per_cell = get_fields_per_halo_cell(current_state)</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    halo_start = merge(2, 1, halo_depth==1)</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    halo_end = merge(3, 4, halo_depth==1)</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="comment">! i moves in x and y. z is 1</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="keywordflow">do</span> i = 2, 3</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      <span class="keywordflow">do</span> j = halo_start, halo_end</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <span class="keywordflow">if</span> (current_state%parallel%my_rank .ne. current_state%local_grid%neighbours(i,j)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;          pid_location = get_pid_neighbour_location(halo_swap_neighbours, &amp;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;               current_state%local_grid%neighbours(i,j), number_distinct_neighbours)</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;          halo_swap_neighbours(pid_location)%halo_pages = &amp;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;               halo_swap_neighbours(pid_location)%halo_pages + fields_per_cell</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="keywordflow">    end do</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a70a20bfed3126af2e0c9da0bca27b957_cgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a70a20bfed3126af2e0c9da0bca27b957_cgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a70a20bfed3126af2e0c9da0bca27b957_cgraph" id="anamespacehalo__communication__mod_a70a20bfed3126af2e0c9da0bca27b957_cgraph">
<area shape="rect" title="Deduces the number of halo pages per neighbour halo swap and places this information in the appropria..." alt="" coords="5,5,180,61"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ab0dc177b2189be5b8ed3877e6081e459" title="Given the process id of a neighbour this determines the location in the data structure of correspondi..." alt="" coords="228,5,393,61"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a70a20bfed3126af2e0c9da0bca27b957_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a70a20bfed3126af2e0c9da0bca27b957_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a70a20bfed3126af2e0c9da0bca27b957_icgraph" id="anamespacehalo__communication__mod_a70a20bfed3126af2e0c9da0bca27b957_icgraph">
<area shape="rect" title="Deduces the number of halo pages per neighbour halo swap and places this information in the appropria..." alt="" coords="481,20,656,76"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ac287e4b520fd9a75f35e58e67ec52880" title="Initialises a halo swapping state, by determining the neighbours, size of data in each swap and alloc..." alt="" coords="231,27,433,69"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="a00aa9edcba7108ca59856b7d5cb2c273"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00aa9edcba7108ca59856b7d5cb2c273">&#9670;&nbsp;</a></span>determine_halo_corner_element_sizes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer function halo_communication_mod::determine_halo_corner_element_sizes </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1local__grid__type.html">local_grid_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>local_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>pid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>For a specific process id this determines the number of halo swap corner elements to involve in a communication. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">local_grid</td><td>The local grid </td></tr>
    <tr><td class="paramname">pid</td><td>The process id that this calculation is based upon @reterns The number of elements involved in a specific corner halo swap </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00575">575</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordtype">type</span>(local_grid_type), <span class="keywordtype">intent(inout)</span> :: local_grid</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: pid</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordtype">integer</span> :: i,j</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    determine_halo_corner_element_sizes=0</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160; </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">do</span> i=1,<span class="keyword">size</span>(local_grid%corner_neighbours, 2)</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      <span class="keywordflow">do</span> j=1,<span class="keyword">size</span>(local_grid%corner_neighbours, 1)</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">if</span> (local_grid%corner_neighbours(j,i) == pid) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;          determine_halo_corner_element_sizes=&amp;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;               determine_halo_corner_element_sizes+local_grid%size(z_index)</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;          <span class="comment">! If second halo then there are 3 corner elements, therefore add extra two to this</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;          <span class="keywordflow">if</span> (i==2) determine_halo_corner_element_sizes=determine_halo_corner_element_sizes+&amp;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;               local_grid%size(z_index)*2</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="keywordflow">      end do</span>      </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="keywordflow">    end do</span>    </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a00aa9edcba7108ca59856b7d5cb2c273_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a00aa9edcba7108ca59856b7d5cb2c273_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a00aa9edcba7108ca59856b7d5cb2c273_icgraph" id="anamespacehalo__communication__mod_a00aa9edcba7108ca59856b7d5cb2c273_icgraph">
<area shape="rect" title="For a specific process id this determines the number of halo swap corner elements to involve in a com..." alt="" coords="449,5,604,61"/>
<area shape="rect" href="namespacetest__halo__communication__mod.html#adf7d2fcb5b93cbce020383caa9ade705" title=" " alt="" coords="224,5,401,61"/>
<area shape="rect" href="test__halocommunication_8F90.html#a384429ec47961a7f013fa1773326628b" title=" " alt="" coords="5,13,176,54"/>
</map>
</div>

</div>
</div>
<a id="a655c6b0b626c430071abf774f6861840"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a655c6b0b626c430071abf774f6861840">&#9670;&nbsp;</a></span>determine_halo_corner_size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer function halo_communication_mod::determine_halo_corner_size </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1local__grid__type.html">local_grid_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>local_grid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determine the halo corner size in elements. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">local_grid</td><td>The local grid </td></tr>
    <tr><td class="paramname">pid</td><td>The process id that this calculation is based upon @reterns The number of elements involved in a specific corner halo swap </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00563">563</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordtype">type</span>(local_grid_type), <span class="keywordtype">intent(inout)</span> :: local_grid</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    determine_halo_corner_size = local_grid%halo_size(x_index)*local_grid%halo_size(y_index)*&amp;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;         local_grid%size(z_index)    </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a655c6b0b626c430071abf774f6861840_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a655c6b0b626c430071abf774f6861840_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a655c6b0b626c430071abf774f6861840_icgraph" id="anamespacehalo__communication__mod_a655c6b0b626c430071abf774f6861840_icgraph">
<area shape="rect" title="Determine the halo corner size in elements." alt="" coords="449,5,597,61"/>
<area shape="rect" href="namespacetest__halo__communication__mod.html#a57a862707fe79ff5082092eda02ad28f" title=" " alt="" coords="224,5,401,61"/>
<area shape="rect" href="test__halocommunication_8F90.html#a384429ec47961a7f013fa1773326628b" title=" " alt="" coords="5,13,176,54"/>
</map>
</div>

</div>
</div>
<a id="a2b7d290453fe4d5d7cb784fdd7970227"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b7d290453fe4d5d7cb784fdd7970227">&#9670;&nbsp;</a></span>determine_recv_and_send_sizes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine halo_communication_mod::determine_recv_and_send_sizes </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1local__grid__type.html">local_grid_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>local_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1neighbour__description__type.html">neighbour_description_type</a>), dimension(:), allocatable&#160;</td>
          <td class="paramname"><em>halo_swap_neighbours</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>number_distinct_neighbours</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>involve_corners</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determines the amount (in elements) of data that each neighbour will be sent and I will receive from in a halo swap. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">local_grid</td><td>The local grid </td></tr>
    <tr><td class="paramname">halo_swap_neighbours</td><td>Structure describing state of halo swap neighbours </td></tr>
    <tr><td class="paramname">number_distinct_neighbours</td><td>The number of distinct neighbours I swap with </td></tr>
    <tr><td class="paramname">involve_corners</td><td>Whether or not to involve corners in a halo swap </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00527">527</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordtype">type</span>(local_grid_type), <span class="keywordtype">intent(inout)</span> :: local_grid</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: number_distinct_neighbours</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: involve_corners</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordtype">type</span>(neighbour_description_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: halo_swap_neighbours</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordtype">integer</span> :: i, normal_size, corner_size</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">do</span> i=1, number_distinct_neighbours</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keywordflow">if</span> (halo_swap_neighbours(i)%halo_pages .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keywordflow">if</span> (halo_swap_neighbours(i)%dimension == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Halo swapping with neighbour needed but dimension is 0 which suggests corner only&quot;</span>)</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="keywordflow">        end if</span>        </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        normal_size=local_grid%size(z_index) * merge(local_grid%size(y_index), local_grid%size(x_index), &amp;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;             halo_swap_neighbours(i)%dimension==x_index)*halo_swap_neighbours(i)%halo_pages</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        normal_size=0</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      halo_swap_neighbours(i)%recv_size=normal_size</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      halo_swap_neighbours(i)%send_size=normal_size</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="keywordflow">if</span> (involve_corners .and. halo_swap_neighbours(i)%halo_corners .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="comment">! For the moment assume both halos are the same neighbour - hence the 4, otherwise should call determine_halo_corner_element_sizes</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        corner_size=local_grid%size(z_index)*4*halo_swap_neighbours(i)%halo_corners</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        corner_size=0</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        halo_swap_neighbours(i)%recv_corner_size=corner_size</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        halo_swap_neighbours(i)%send_corner_size=corner_size</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keywordflow">    end do</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a2b7d290453fe4d5d7cb784fdd7970227_cgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a2b7d290453fe4d5d7cb784fdd7970227_cgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a2b7d290453fe4d5d7cb784fdd7970227_cgraph" id="anamespacehalo__communication__mod_a2b7d290453fe4d5d7cb784fdd7970227_cgraph">
<area shape="rect" title="Determines the amount (in elements) of data that each neighbour will be sent and I will receive from ..." alt="" coords="5,5,155,61"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="203,20,345,47"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="393,13,560,54"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a2b7d290453fe4d5d7cb784fdd7970227_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a2b7d290453fe4d5d7cb784fdd7970227_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a2b7d290453fe4d5d7cb784fdd7970227_icgraph" id="anamespacehalo__communication__mod_a2b7d290453fe4d5d7cb784fdd7970227_icgraph">
<area shape="rect" title="Determines the amount (in elements) of data that each neighbour will be sent and I will receive from ..." alt="" coords="481,20,631,76"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ac287e4b520fd9a75f35e58e67ec52880" title="Initialises a halo swapping state, by determining the neighbours, size of data in each swap and alloc..." alt="" coords="231,27,433,69"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="a9f9daddadb8276b6a0d2d13e2e8ce1d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f9daddadb8276b6a0d2d13e2e8ce1d5">&#9670;&nbsp;</a></span>finalise_halo_communication()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public halo_communication_mod::finalise_halo_communication </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1halo__communication__type.html">halo_communication_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>halo_swap_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finalises the halo swap represented by the state by freeing up all the allocated memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">halo_swap_state</td><td>State of the specific halo swap </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00339">339</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordtype">type</span>(halo_communication_type), <span class="keywordtype">intent(inout)</span> :: halo_swap_state</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordtype">integer</span> :: i</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="comment">! TODO - issue cancel of outstanding requests here</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(halo_swap_state%send_requests)) <span class="keyword">deallocate</span>(halo_swap_state%send_requests)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(halo_swap_state%recv_requests)) <span class="keyword">deallocate</span>(halo_swap_state%recv_requests)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">do</span> i=1,halo_swap_state%number_distinct_neighbours</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(halo_swap_state%halo_swap_neighbours(i)%send_halo_buffer)) &amp;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;           <span class="keyword">deallocate</span>(halo_swap_state%halo_swap_neighbours(i)%send_halo_buffer)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(halo_swap_state%halo_swap_neighbours(i)%recv_halo_buffer)) &amp;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;           <span class="keyword">deallocate</span>(halo_swap_state%halo_swap_neighbours(i)%recv_halo_buffer)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(halo_swap_state%halo_swap_neighbours)) <span class="keyword">deallocate</span>(halo_swap_state%halo_swap_neighbours)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    halo_swap_state%initialised=.false.</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a9f9daddadb8276b6a0d2d13e2e8ce1d5_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a9f9daddadb8276b6a0d2d13e2e8ce1d5_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a9f9daddadb8276b6a0d2d13e2e8ce1d5_icgraph" id="anamespacehalo__communication__mod_a9f9daddadb8276b6a0d2d13e2e8ce1d5_icgraph">
<area shape="rect" title="Finalises the halo swap represented by the state by freeing up all the allocated memory." alt="" coords="231,20,372,76"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="a65991d14beaafd48f7841ccc35be5e98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65991d14beaafd48f7841ccc35be5e98">&#9670;&nbsp;</a></span>generate_recv_field_buffer_matches()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine halo_communication_mod::generate_recv_field_buffer_matches </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>halo_depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>cell_match</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Precalculates the received buffer to field halo cell matches for each dimension and called from the initialisation stage. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
    <tr><td class="paramname">halo_depth</td><td>The halo depth </td></tr>
    <tr><td class="paramname">cell_match</td><td>The matching cells are written into here </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00789">789</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: halo_depth</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: cell_match(:,:)</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160; </div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">dimension(3)</span> :: same_neighbours</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordtype">integer</span> :: i,j</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    same_neighbours = retrieve_same_neighbour_information(current_state%local_grid)</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordflow">do</span> i = 2,3</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;       <span class="keywordflow">if</span> (halo_depth == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;          cell_match(i,1)=1</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;          cell_match(i,2)=merge(2, 3, .not. same_neighbours(i))</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;          cell_match(i,3)=merge(3, 2, .not. same_neighbours(i))</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;          cell_match(i,4)=4</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;       <span class="keywordflow">else</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;          <span class="keywordflow">do</span> j = 1, halo_depth</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;             cell_match(i,j) = merge(j, j+halo_depth, .not. same_neighbours(i))</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;             cell_match(i,j+halo_depth) = merge(j+halo_depth, j, .not. same_neighbours(i))</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;       <span class="comment">!          cell_match(i,j) = merge(2, 4, .not. same_neighbours(i))</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;       <span class="comment">!          cell_match(i,j) = merge(3, 1, .not. same_neighbours(i))</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="comment">!          cell_match(i,j) = merge(4, 2, .not. same_neighbours(i))</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="keywordflow">    end do</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a65991d14beaafd48f7841ccc35be5e98_cgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a65991d14beaafd48f7841ccc35be5e98_cgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a65991d14beaafd48f7841ccc35be5e98_cgraph" id="anamespacehalo__communication__mod_a65991d14beaafd48f7841ccc35be5e98_cgraph">
<area shape="rect" title="Precalculates the received buffer to field halo cell matches for each dimension and called from the i..." alt="" coords="5,5,153,61"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a7fb6163656e68853626d592e6d94cd5c" title="Retrieves whether we have the same neighbours for L and R halo swaps in each dimension." alt="" coords="201,5,357,61"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a65991d14beaafd48f7841ccc35be5e98_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a65991d14beaafd48f7841ccc35be5e98_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a65991d14beaafd48f7841ccc35be5e98_icgraph" id="anamespacehalo__communication__mod_a65991d14beaafd48f7841ccc35be5e98_icgraph">
<area shape="rect" title="Precalculates the received buffer to field halo cell matches for each dimension and called from the i..." alt="" coords="481,20,629,76"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ac287e4b520fd9a75f35e58e67ec52880" title="Initialises a halo swapping state, by determining the neighbours, size of data in each swap and alloc..." alt="" coords="231,27,433,69"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="a7094ec3a38213e4ae98ec0af56f30bd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7094ec3a38213e4ae98ec0af56f30bd2">&#9670;&nbsp;</a></span>get_number_communication_requests()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer function halo_communication_mod::get_number_communication_requests </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1neighbour__description__type.html">neighbour_description_type</a>), dimension(:), allocatable&#160;</td>
          <td class="paramname"><em>halo_swap_neighbours</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>number_distinct_neighbours</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determines the overall number of communication requests, which is made up of normal halo swaps and potentially corner swaps too if that is enabled. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">halo_swap_neighbours</td><td>Neighbouring halo swap state </td></tr>
    <tr><td class="paramname">number_distinct_neighbours</td><td>The number of distinct neighours that I will swap with </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of communication requests </dd></dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00505">505</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: number_distinct_neighbours</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordtype">type</span>(neighbour_description_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: halo_swap_neighbours</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordtype">integer</span> :: i</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    get_number_communication_requests=0</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">do</span> i=1, number_distinct_neighbours</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="keywordflow">if</span> (halo_swap_neighbours(i)%recv_size .gt. 0) &amp;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;           get_number_communication_requests=get_number_communication_requests+1</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordflow">if</span> (halo_swap_neighbours(i)%recv_corner_size .gt. 0)&amp;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;           get_number_communication_requests=get_number_communication_requests+1</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="keywordflow">    end do</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a7094ec3a38213e4ae98ec0af56f30bd2_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a7094ec3a38213e4ae98ec0af56f30bd2_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a7094ec3a38213e4ae98ec0af56f30bd2_icgraph" id="anamespacehalo__communication__mod_a7094ec3a38213e4ae98ec0af56f30bd2_icgraph">
<area shape="rect" title="Determines the overall number of communication requests, which is made up of normal halo swaps and po..." alt="" coords="481,64,704,120"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ac287e4b520fd9a75f35e58e67ec52880" title="Initialises a halo swapping state, by determining the neighbours, size of data in each swap and alloc..." alt="" coords="231,31,433,73"/>
<area shape="rect" href="namespacetest__halo__communication__mod.html#a0f3d3313f41be8af941da72c864035e9" title=" " alt="" coords="245,100,419,156"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
<area shape="rect" href="test__halocommunication_8F90.html#a384429ec47961a7f013fa1773326628b" title=" " alt="" coords="9,115,179,157"/>
</map>
</div>

</div>
</div>
<a id="a67c8b944efbd7a4548ba73b96c1b5e5d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67c8b944efbd7a4548ba73b96c1b5e5d">&#9670;&nbsp;</a></span>get_number_of_processes_involved_in_communication()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer function halo_communication_mod::get_number_of_processes_involved_in_communication </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1local__grid__type.html">local_grid_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>local_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>my_rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>include_corners</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Deduces the number of distinct neighbours that will be involved in a halo swap. This information is used to then allocate the appropriate amount of memory to store the neighbour halo swapping data structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">local_grid</td><td>Description of the local grid </td></tr>
    <tr><td class="paramname">my_rank</td><td>My global PID </td></tr>
    <tr><td class="paramname">include_corners</td><td>Whether to include corners or not </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00601">601</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordtype">type</span>(local_grid_type), <span class="keywordtype">intent(inout)</span> :: local_grid</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: my_rank</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: include_corners</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordtype">integer</span> :: i, j, temp_neighbour_pids(merge(16, 8, include_corners))</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    temp_neighbour_pids(:)=-1</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    get_number_of_processes_involved_in_communication=0</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">do</span> i=2,3</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="keywordflow">do</span> j=1,4</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">if</span> (local_grid%neighbours(i,j) .ne. my_rank .and. .not. &amp;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;             has_pid_already_been_seen(temp_neighbour_pids, &amp;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;             local_grid%neighbours(i,j))) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;          get_number_of_processes_involved_in_communication = &amp;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;               get_number_of_processes_involved_in_communication+1</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;          temp_neighbour_pids(get_number_of_processes_involved_in_communication) = &amp;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;               local_grid%neighbours(i,j)</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="keywordflow">        end if</span>        </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="keywordflow">      end do</span>      </div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">if</span> (include_corners) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="keywordflow">do</span> i=1,<span class="keyword">size</span>(local_grid%corner_neighbours, 2)</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keywordflow">do</span> j=1,<span class="keyword">size</span>(local_grid%corner_neighbours, 1)</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;          <span class="keywordflow">if</span> (local_grid%corner_neighbours(j,i) .ne. my_rank .and. .not. &amp;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;               has_pid_already_been_seen(temp_neighbour_pids, &amp;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;               local_grid%corner_neighbours(j,i))) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            get_number_of_processes_involved_in_communication = &amp;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                 get_number_of_processes_involved_in_communication+1</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            temp_neighbour_pids(get_number_of_processes_involved_in_communication) = &amp;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                 local_grid%corner_neighbours(j,i)</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="keywordflow">          end if</span>          </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="keywordflow">      end do</span>      </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a67c8b944efbd7a4548ba73b96c1b5e5d_cgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a67c8b944efbd7a4548ba73b96c1b5e5d_cgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a67c8b944efbd7a4548ba73b96c1b5e5d_cgraph" id="anamespacehalo__communication__mod_a67c8b944efbd7a4548ba73b96c1b5e5d_cgraph">
<area shape="rect" title="Deduces the number of distinct neighbours that will be involved in a halo swap. This information is u..." alt="" coords="5,5,167,76"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a4529b50fe46e332faf902bfa28144ae9" title="Returns whether or not a specific process id has already been &quot;seen&quot; by searching a list of already s..." alt="" coords="215,13,368,69"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a67c8b944efbd7a4548ba73b96c1b5e5d_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a67c8b944efbd7a4548ba73b96c1b5e5d_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a67c8b944efbd7a4548ba73b96c1b5e5d_icgraph" id="anamespacehalo__communication__mod_a67c8b944efbd7a4548ba73b96c1b5e5d_icgraph">
<area shape="rect" title="Deduces the number of distinct neighbours that will be involved in a halo swap. This information is u..." alt="" coords="481,13,643,83"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ac287e4b520fd9a75f35e58e67ec52880" title="Initialises a halo swapping state, by determining the neighbours, size of data in each swap and alloc..." alt="" coords="231,27,433,69"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="ab0dc177b2189be5b8ed3877e6081e459"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0dc177b2189be5b8ed3877e6081e459">&#9670;&nbsp;</a></span>get_pid_neighbour_location()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer function halo_communication_mod::get_pid_neighbour_location </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1neighbour__description__type.html">neighbour_description_type</a>), dimension(:), allocatable&#160;</td>
          <td class="paramname"><em>halo_swap_neighbours</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>pid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>number_distinct_neighbours</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Given the process id of a neighbour this determines the location in the data structure of corresponding data for that. Note that this is an O(n) operation so ideally call once and reuse the results. If no process id is found then returns -1. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">halo_swap_neighbours</td><td>PIDs of the neighbouring processes to me </td></tr>
    <tr><td class="paramname">pid</td><td>The process id to find </td></tr>
    <tr><td class="paramname">number_distinct_neighbours</td><td>The number of distinct neighbours I have </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l01209">1209</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    <span class="keywordtype">type</span>(neighbour_description_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: halo_swap_neighbours</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: pid, number_distinct_neighbours</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160; </div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="keywordtype">integer</span> :: i</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160; </div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="keywordflow">do</span> i=1, number_distinct_neighbours</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      <span class="keywordflow">if</span> (halo_swap_neighbours(i)%pid == pid) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        get_pid_neighbour_location = i</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="keywordflow">      end if</span>      </div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="comment">! Not found</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    get_pid_neighbour_location=-1</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_ab0dc177b2189be5b8ed3877e6081e459_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_ab0dc177b2189be5b8ed3877e6081e459_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_ab0dc177b2189be5b8ed3877e6081e459_icgraph" id="anamespacehalo__communication__mod_ab0dc177b2189be5b8ed3877e6081e459_icgraph">
<area shape="rect" title="Given the process id of a neighbour this determines the location in the data structure of correspondi..." alt="" coords="949,155,1115,211"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a3c46cf4c2f61bbbc70e2a86a2c6f741e" title="Copies the received data (held in buffers) from neighbours into the correct halo location in the prog..." alt="" coords="725,7,883,63"/>
<area shape="rect" href="namespacehalo__communication__mod.html#afbfc482aae9fcfa289e8fff653e8a714" title="Determines the number of halo corners to swap between specific neighours, this is similar to deducing..." alt="" coords="713,155,895,211"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a70a20bfed3126af2e0c9da0bca27b957" title="Deduces the number of halo pages per neighbour halo swap and places this information in the appropria..." alt="" coords="717,235,891,291"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a0e57e9753603d764609afb1f4cb2087b" title="Copies all applicable bits of the prognostics into a send buffer for each neighbour and then issues a..." alt="" coords="731,90,877,131"/>
<area shape="rect" href="namespacetest__halo__communication__mod.html#af21fd5ed4d99ed3b465aa2687c4a91ac" title=" " alt="" coords="707,315,901,371"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a02b04565afda3dc93273a16944a2976e" title="This completes a nonblocking halo swap and it is only during this call that the data fields themselve..." alt="" coords="463,5,652,61"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a0a11eeeaa1e80eab180fb8652ce592a6" title="Performs the entire halo swap operation, this is simply a wrapper around the nonblocking initiate and..." alt="" coords="231,63,408,105"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,71,183,156"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ac287e4b520fd9a75f35e58e67ec52880" title="Initialises a halo swapping state, by determining the neighbours, size of data in each swap and alloc..." alt="" coords="456,173,659,214"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a8dac8c6529d0169c9e4402690f62d581" title="Initiates a non blocking halo swap, this registers the receive requests, copies data into the send bu..." alt="" coords="470,85,645,141"/>
<area shape="rect" href="test__halocommunication_8F90.html#a384429ec47961a7f013fa1773326628b" title=" " alt="" coords="472,322,643,363"/>
</map>
</div>

</div>
</div>
<a id="aaff14692e79ef19796f8c6af98bc6ef9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaff14692e79ef19796f8c6af98bc6ef9">&#9670;&nbsp;</a></span>get_single_field_per_halo_cell()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public halo_communication_mod::get_single_field_per_halo_cell </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A very common function, which returns a single field per halo cell which is used to halo swap just one field. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l01229">1229</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state    </div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160; </div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    get_single_field_per_halo_cell=1</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_aaff14692e79ef19796f8c6af98bc6ef9_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_aaff14692e79ef19796f8c6af98bc6ef9_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_aaff14692e79ef19796f8c6af98bc6ef9_icgraph" id="anamespacehalo__communication__mod_aaff14692e79ef19796f8c6af98bc6ef9_icgraph">
<area shape="rect" title="A very common function, which returns a single field per halo cell which is used to halo swap just on..." alt="" coords="231,20,380,76"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="a4529b50fe46e332faf902bfa28144ae9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4529b50fe46e332faf902bfa28144ae9">&#9670;&nbsp;</a></span>has_pid_already_been_seen()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical function halo_communication_mod::has_pid_already_been_seen </td>
          <td>(</td>
          <td class="paramtype">integer, dimension(8), intent(in)&#160;</td>
          <td class="paramname"><em>temp_neighbour_pids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>pid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns whether or not a specific process id has already been "seen" by searching a list of already seen process ids. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">temp_neighbour_pids</td><td>The process Ids already seen </td></tr>
    <tr><td class="paramname">pid</td><td>The PID to search for </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l01187">1187</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: pid, temp_neighbour_pids(8)</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160; </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordtype">integer</span> :: i</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160; </div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    has_pid_already_been_seen=.true.</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <span class="keywordflow">do</span> i=1,8</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      <span class="keywordflow">if</span> (temp_neighbour_pids(i) == pid) <span class="keywordflow">return</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      <span class="keywordflow">if</span> (temp_neighbour_pids(i) == -1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        has_pid_already_been_seen=.false.</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="keywordflow">      end if</span>      </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    has_pid_already_been_seen=.false.</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a4529b50fe46e332faf902bfa28144ae9_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a4529b50fe46e332faf902bfa28144ae9_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a4529b50fe46e332faf902bfa28144ae9_icgraph" id="anamespacehalo__communication__mod_a4529b50fe46e332faf902bfa28144ae9_icgraph">
<area shape="rect" title="Returns whether or not a specific process id has already been &quot;seen&quot; by searching a list of already s..." alt="" coords="705,101,859,157"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a67c8b944efbd7a4548ba73b96c1b5e5d" title="Deduces the number of distinct neighbours that will be involved in a halo swap. This information is u..." alt="" coords="489,5,650,76"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a4c4471d526bafd49024cd360feeed138" title="Will populate the halo swap neighbour data strutures with appropriate neighbour pid and dimension num..." alt="" coords="499,101,640,157"/>
<area shape="rect" href="namespacetest__halo__communication__mod.html#a302935f6660ea7ab739e07b894c2b596" title=" " alt="" coords="481,180,657,221"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ac287e4b520fd9a75f35e58e67ec52880" title="Initialises a halo swapping state, by determining the neighbours, size of data in each swap and alloc..." alt="" coords="231,64,433,105"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,42,183,127"/>
<area shape="rect" href="test__halocommunication_8F90.html#a384429ec47961a7f013fa1773326628b" title=" " alt="" coords="247,180,417,221"/>
</map>
</div>

</div>
</div>
<a id="ac287e4b520fd9a75f35e58e67ec52880"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac287e4b520fd9a75f35e58e67ec52880">&#9670;&nbsp;</a></span>init_halo_communication()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public halo_communication_mod::init_halo_communication </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1get__fields__per__halo__cell__proc__interface.html">get_fields_per_halo_cell_proc_interface</a>)&#160;</td>
          <td class="paramname"><em>get_fields_per_halo_cell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1halo__communication__type.html">halo_communication_type</a>), intent(out)&#160;</td>
          <td class="paramname"><em>halo_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>halo_depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>involve_corners</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialises a halo swapping state, by determining the neighbours, size of data in each swap and allocating the required memory - which are communication buffers and request handles. All this information is placed into the returned state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
    <tr><td class="paramname">get_fields_per_halo_cell</td><td>Procedure pointer to the procedure which determines how many fields per halo cell there are </td></tr>
    <tr><td class="paramname">involve_corners</td><td>Whether this involves corners or not </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A halo swapping state which can be used for halo swapping operations </dd></dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00293">293</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordtype">procedure</span>(get_fields_per_halo_cell_proc_interface) :: get_fields_per_halo_cell</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: involve_corners</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: halo_depth</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordtype">type</span>(halo_communication_type), <span class="keywordtype">intent(out)</span> :: halo_state</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordtype">integer</span> :: number_comm_requests</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    halo_state%involve_corners = involve_corners</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    halo_state%halo_depth = halo_depth</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    halo_state%number_distinct_neighbours = get_number_of_processes_involved_in_communication(&amp;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;         current_state%local_grid, current_state%parallel%my_rank, involve_corners)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span> (halo_state%number_distinct_neighbours .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="keyword">allocate</span>(halo_state%halo_swap_neighbours(halo_state%number_distinct_neighbours))</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      halo_state%halo_swap_neighbours = populate_halo_swap_neighbours(current_state%local_grid, &amp;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;           current_state%parallel%my_rank, halo_state%number_distinct_neighbours, involve_corners)</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keyword">call </span>deduce_halo_pages_per_neighbour(current_state, halo_state%halo_swap_neighbours, &amp;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;           halo_state%number_distinct_neighbours, get_fields_per_halo_cell, &amp;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;           halo_state%fields_per_cell, halo_depth)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="keywordflow">if</span> (involve_corners) <span class="keyword">call </span>deduce_halo_corners_per_neighbour(current_state, &amp;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;           halo_state%halo_swap_neighbours, &amp;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;           halo_state%number_distinct_neighbours, halo_state%fields_per_cell)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="keyword">call </span>allocate_halo_buffers_for_each_neighbour(current_state%local_grid, &amp;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;           halo_state%number_distinct_neighbours, &amp;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;           halo_state%halo_swap_neighbours)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keyword">call </span>determine_recv_and_send_sizes(current_state%local_grid, &amp;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;           halo_state%halo_swap_neighbours, &amp;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;           halo_state%number_distinct_neighbours, involve_corners)</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="keyword">call </span>generate_recv_field_buffer_matches(current_state, halo_state%halo_depth, &amp;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;           halo_state%cell_match)</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="comment">! required for nonblocking MPI communcations</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      number_comm_requests = get_number_communication_requests(halo_state%halo_swap_neighbours, &amp;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;           halo_state%number_distinct_neighbours)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="keyword">allocate</span>(halo_state%send_requests(number_comm_requests), &amp;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;           halo_state%recv_requests(number_comm_requests))</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      halo_state%send_requests(:) = mpi_request_null</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      halo_state%recv_requests(:) = mpi_request_null</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    halo_state%initialised = .true.</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_ac287e4b520fd9a75f35e58e67ec52880_cgraph.png" border="0" usemap="#anamespacehalo__communication__mod_ac287e4b520fd9a75f35e58e67ec52880_cgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_ac287e4b520fd9a75f35e58e67ec52880_cgraph" id="anamespacehalo__communication__mod_ac287e4b520fd9a75f35e58e67ec52880_cgraph">
<area shape="rect" title="Initialises a halo swapping state, by determining the neighbours, size of data in each swap and alloc..." alt="" coords="5,293,208,334"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ac05c8c755524caac5a4aacbcd37848e0" title="Allocates the locally stored halo buffers (send and receive) for each neighbouring process." alt="" coords="273,5,461,61"/>
<area shape="rect" href="namespacehalo__communication__mod.html#afbfc482aae9fcfa289e8fff653e8a714" title="Determines the number of halo corners to swap between specific neighours, this is similar to deducing..." alt="" coords="276,85,459,141"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a70a20bfed3126af2e0c9da0bca27b957" title="Deduces the number of halo pages per neighbour halo swap and places this information in the appropria..." alt="" coords="280,165,455,221"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a2b7d290453fe4d5d7cb784fdd7970227" title="Determines the amount (in elements) of data that each neighbour will be sent and I will receive from ..." alt="" coords="293,245,442,301"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a65991d14beaafd48f7841ccc35be5e98" title="Precalculates the received buffer to field halo cell matches for each dimension and called from the i..." alt="" coords="293,325,441,381"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a7094ec3a38213e4ae98ec0af56f30bd2" title="Determines the overall number of communication requests, which is made up of normal halo swaps and po..." alt="" coords="256,405,479,461"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a67c8b944efbd7a4548ba73b96c1b5e5d" title="Deduces the number of distinct neighbours that will be involved in a halo swap. This information is u..." alt="" coords="287,486,448,557"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a4c4471d526bafd49024cd360feeed138" title="Will populate the halo swap neighbour data strutures with appropriate neighbour pid and dimension num..." alt="" coords="297,581,438,637"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ab0dc177b2189be5b8ed3877e6081e459" title="Given the process id of a neighbour this determines the location in the data structure of correspondi..." alt="" coords="527,125,692,181"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="538,260,681,287"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="740,253,907,294"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a7fb6163656e68853626d592e6d94cd5c" title="Retrieves whether we have the same neighbours for L and R halo swaps in each dimension." alt="" coords="531,325,687,381"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a4529b50fe46e332faf902bfa28144ae9" title="Returns whether or not a specific process id has already been &quot;seen&quot; by searching a list of already s..." alt="" coords="533,537,686,593"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_ac287e4b520fd9a75f35e58e67ec52880_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_ac287e4b520fd9a75f35e58e67ec52880_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_ac287e4b520fd9a75f35e58e67ec52880_icgraph" id="anamespacehalo__communication__mod_ac287e4b520fd9a75f35e58e67ec52880_icgraph">
<area shape="rect" title="Initialises a halo swapping state, by determining the neighbours, size of data in each swap and alloc..." alt="" coords="231,27,433,69"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="a8dac8c6529d0169c9e4402690f62d581"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8dac8c6529d0169c9e4402690f62d581">&#9670;&nbsp;</a></span>initiate_nonblocking_halo_swap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public halo_communication_mod::initiate_nonblocking_halo_swap </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1halo__communication__type.html">halo_communication_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>halo_swap_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1copy__fields__to__halo__buffer__proc__interface.html">copy_fields_to_halo_buffer_proc_interface</a>)&#160;</td>
          <td class="paramname"><em>copy_to_halo_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1copy__corners__to__halo__buffer__proc__interface.html">copy_corners_to_halo_buffer_proc_interface</a>), optional&#160;</td>
          <td class="paramname"><em>copy_corners_to_halo_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1field__data__wrapper__type.html">field_data_wrapper_type</a>), dimension(:), intent(in), optional&#160;</td>
          <td class="paramname"><em>source_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initiates a non blocking halo swap, this registers the receive requests, copies data into the send buffer and then registers send requests for these. As far as this call is concerned, the data is immutable - no modifications will take place to it until the matching completion call is made. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
    <tr><td class="paramname">halo_swap_state</td><td>The halo swapping state </td></tr>
    <tr><td class="paramname">copy_to_halo_buffer</td><td>Procedure pointer which is called to copy the data into the halo send buffer </td></tr>
    <tr><td class="paramname">copy_corners_to_halo_buffer</td><td>Optional procedure pointer which copies field corners into halo buffer </td></tr>
    <tr><td class="paramname">source_data</td><td>Optional source data which is read from into send buffers and written into by receieve buffers </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00243">243</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordtype">type</span>(halo_communication_type), <span class="keywordtype">intent(inout)</span> :: halo_swap_state</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordtype">procedure</span>(copy_fields_to_halo_buffer_proc_interface) :: copy_to_halo_buffer</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordtype">procedure</span>(copy_corners_to_halo_buffer_proc_interface), <span class="keywordtype">optional</span> :: copy_corners_to_halo_buffer</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordtype">type</span>(field_data_wrapper_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: source_data</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    halo_swap_state%swap_in_progress = .true.</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">if</span> (halo_swap_state%number_distinct_neighbours .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;       halo_swap_state%send_requests(:) = mpi_request_null</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;       halo_swap_state%recv_requests(:) = mpi_request_null</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;       </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;       <span class="keywordflow">if</span> ((<span class="keyword">present</span>(copy_corners_to_halo_buffer) .and. .not. halo_swap_state%involve_corners) &amp;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            .or.  (.not. <span class="keyword">present</span>(copy_corners_to_halo_buffer) .and. &amp;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            halo_swap_state%involve_corners)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#a10e28447dd10ef9f92d205bc98fb26d3">log_warn</a>, <span class="stringliteral">&quot;Inconsistent halo swap corner state and corner subroutine call arguments&quot;</span>)</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;       <span class="comment">! we call recv before send</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;       <span class="keyword">call </span>recv_all_halos(current_state, halo_swap_state)</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;       </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;       <span class="keywordflow">if</span> (<span class="keyword">present</span>(source_data)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;          <span class="keywordflow">if</span> (halo_swap_state%involve_corners .and. <span class="keyword">present</span>(copy_corners_to_halo_buffer)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;             <span class="keyword">call </span>send_all_halos(current_state, halo_swap_state, copy_to_halo_buffer, &amp;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                  copy_corners_to_halo_buffer, source_data)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;             <span class="keyword">call </span>send_all_halos(current_state, halo_swap_state, copy_to_halo_buffer, &amp;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                  source_data=source_data)</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;       <span class="keywordflow">else</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;          <span class="keywordflow">if</span> (halo_swap_state%involve_corners .and. <span class="keyword">present</span>(copy_corners_to_halo_buffer)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;             <span class="keyword">call </span>send_all_halos(current_state, halo_swap_state, copy_to_halo_buffer, &amp;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                  copy_corners_to_halo_buffer)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;             <span class="keyword">call </span>send_all_halos(current_state, halo_swap_state, copy_to_halo_buffer)</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a8dac8c6529d0169c9e4402690f62d581_cgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a8dac8c6529d0169c9e4402690f62d581_cgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a8dac8c6529d0169c9e4402690f62d581_cgraph" id="anamespacehalo__communication__mod_a8dac8c6529d0169c9e4402690f62d581_cgraph">
<area shape="rect" title="Initiates a non blocking halo swap, this registers the receive requests, copies data into the send bu..." alt="" coords="5,57,180,113"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="230,13,373,39"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a9537cebc6ed24d00aa7e34e6c66a9e29" title="Registers receive requests for all prognostic fields from the appropriate neighbouring processes (tha..." alt="" coords="230,64,373,105"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a0e57e9753603d764609afb1f4cb2087b" title="Copies all applicable bits of the prognostics into a send buffer for each neighbour and then issues a..." alt="" coords="228,129,375,171"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="423,5,589,47"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ab0dc177b2189be5b8ed3877e6081e459" title="Given the process id of a neighbour this determines the location in the data structure of correspondi..." alt="" coords="423,122,589,178"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a8dac8c6529d0169c9e4402690f62d581_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a8dac8c6529d0169c9e4402690f62d581_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a8dac8c6529d0169c9e4402690f62d581_icgraph" id="anamespacehalo__communication__mod_a8dac8c6529d0169c9e4402690f62d581_icgraph">
<area shape="rect" title="Initiates a non blocking halo swap, this registers the receive requests, copies data into the send bu..." alt="" coords="456,27,631,83"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a0a11eeeaa1e80eab180fb8652ce592a6" title="Performs the entire halo swap operation, this is simply a wrapper around the nonblocking initiate and..." alt="" coords="231,5,408,47"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,13,183,98"/>
</map>
</div>

</div>
</div>
<a id="af6146f7138547a3210839b478418856b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6146f7138547a3210839b478418856b">&#9670;&nbsp;</a></span>perform_local_data_copy_for_corners()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine halo_communication_mod::perform_local_data_copy_for_corners </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>my_rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1local__grid__type.html">local_grid_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>local_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>field_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Performs a local data copy for corners when the neighbour is local (me) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">my_rank</td><td>My global rank </td></tr>
    <tr><td class="paramname">local_grid</td><td>The local grid </td></tr>
    <tr><td class="paramname">field_data</td><td>The field data top copy into </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l01041">1041</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="keywordtype">type</span>(local_grid_type), <span class="keywordtype">intent(inout)</span> :: local_grid</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: field_data</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: my_rank</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160; </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="keywordtype">integer</span> :: i, y_source_index, x_source_index, y_target_index, x_target_index</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160; </div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="keywordflow">do</span> i=1,<span class="keyword">size</span>(local_grid%corner_neighbours, 1)</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      <span class="keywordflow">if</span> (my_rank .eq. local_grid%corner_neighbours(i,1)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <span class="keywordflow">if</span> (i==1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;          y_source_index=local_grid%local_domain_end_index(y_index)-1</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;          x_source_index=local_grid%local_domain_end_index(x_index)-1</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;          y_target_index=1</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;          x_target_index=1</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;          y_source_index=local_grid%local_domain_end_index(y_index)-1</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;          x_source_index=local_grid%local_domain_start_index(x_index)</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;          y_target_index=1</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;          x_target_index=local_grid%local_domain_end_index(x_index)+1</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==3) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;          y_source_index=local_grid%local_domain_start_index(y_index)</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;          x_source_index=local_grid%local_domain_end_index(x_index)-1</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;          y_target_index=local_grid%local_domain_end_index(y_index)+1</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;          x_target_index=1</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==4) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;          y_source_index=local_grid%local_domain_start_index(y_index)</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;          x_source_index=local_grid%local_domain_start_index(x_index)</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;          y_target_index=local_grid%local_domain_end_index(y_index)+1</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;          x_target_index=local_grid%local_domain_end_index(x_index)+1</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160; </div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;             local_grid%local_domain_end_index(z_index),&amp;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;             y_target_index, x_target_index)=&amp;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;             field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;             local_grid%local_domain_end_index(z_index),y_source_index, x_source_index)</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;             local_grid%local_domain_end_index(z_index),&amp;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;             y_target_index+1, x_target_index)=&amp;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;             field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;             local_grid%local_domain_end_index(z_index),y_source_index+1, x_source_index)</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160; </div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;             local_grid%local_domain_end_index(z_index),&amp;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;             y_target_index, x_target_index+1)=&amp;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;             field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;             local_grid%local_domain_end_index(z_index),y_source_index, x_source_index+1)</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        </div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;             local_grid%local_domain_end_index(z_index),&amp;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;             y_target_index+1, x_target_index+1)=&amp;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;             field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;             local_grid%local_domain_end_index(z_index),y_source_index+1, x_source_index+1)       </div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="keywordflow">      end if</span>      </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="keywordflow">    end do</span>    </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_af6146f7138547a3210839b478418856b_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_af6146f7138547a3210839b478418856b_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_af6146f7138547a3210839b478418856b_icgraph" id="anamespacehalo__communication__mod_af6146f7138547a3210839b478418856b_icgraph">
<area shape="rect" title="Performs a local data copy for corners when the neighbour is local (me)" alt="" coords="420,20,580,76"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a2eba69a892b0533614ecccad674e61ed" title="Will perform a a local copy for the halo data of a field." alt="" coords="231,20,372,76"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="a82ba20e03d4564be84a6186cfcebfc68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82ba20e03d4564be84a6186cfcebfc68">&#9670;&nbsp;</a></span>perform_local_data_copy_for_dimension()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine halo_communication_mod::perform_local_data_copy_for_dimension </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>my_rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>halo_depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1local__grid__type.html">local_grid_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>local_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>field_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Performs a local data copy for a specific dimension of a prognostic field. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dim</td><td>The dimension </td></tr>
    <tr><td class="paramname">my_rank</td><td>My process Id </td></tr>
    <tr><td class="paramname">local_grid</td><td>The local grid description </td></tr>
    <tr><td class="paramname">field_data</td><td>The field data that we are going to copy from and to </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l01104">1104</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keywordtype">type</span>(local_grid_type), <span class="keywordtype">intent(inout)</span> :: local_grid</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: field_data</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: dim, my_rank, halo_depth</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160; </div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="keywordtype">integer</span> i, target_index, source_index, hstart, hend</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160; </div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    hstart=merge(2,1, halo_depth==1)</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    hend=merge(3,4, halo_depth==1)</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160; </div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="keywordflow">do</span> i=hstart, hend</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      <span class="keywordflow">if</span> (local_grid%neighbours(dim,i) .eq. my_rank) <span class="keywordflow">then</span> </div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        <span class="keywordflow">if</span> (i==1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;          target_index=1</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;          source_index=local_grid%local_domain_end_index(dim)-1</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==2) <span class="keywordflow">then</span> </div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;          target_index=2</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;          source_index=local_grid%local_domain_end_index(dim)</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==3) <span class="keywordflow">then</span> </div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;          target_index=local_grid%local_domain_end_index(dim)+1</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;          source_index=local_grid%local_domain_start_index(dim)</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==4) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;          target_index=local_grid%local_domain_end_index(dim)+2</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;          source_index=local_grid%local_domain_start_index(dim)+1</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        <span class="keywordflow">if</span> (dim == x_index) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;          field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;               local_grid%local_domain_end_index(z_index),&amp;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;               local_grid%local_domain_start_index(y_index):&amp;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;               local_grid%local_domain_end_index(y_index), target_index) = &amp;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;               field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;               local_grid%local_domain_end_index(z_index),&amp;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;               local_grid%local_domain_start_index(y_index):&amp;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;               local_grid%local_domain_end_index(y_index), source_index)</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;          field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;               local_grid%local_domain_end_index(z_index),&amp;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;               target_index, local_grid%local_domain_start_index(x_index):&amp;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;               local_grid%local_domain_end_index(x_index)) = &amp;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;               field_data(local_grid%local_domain_start_index(z_index):&amp;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;               local_grid%local_domain_end_index(z_index),&amp;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;               source_index, local_grid%local_domain_start_index(x_index):&amp;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;               local_grid%local_domain_end_index(x_index))</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="keywordflow">    end do</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a82ba20e03d4564be84a6186cfcebfc68_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a82ba20e03d4564be84a6186cfcebfc68_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a82ba20e03d4564be84a6186cfcebfc68_icgraph" id="anamespacehalo__communication__mod_a82ba20e03d4564be84a6186cfcebfc68_icgraph">
<area shape="rect" title="Performs a local data copy for a specific dimension of a prognostic field." alt="" coords="455,64,631,120"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a2eba69a892b0533614ecccad674e61ed" title="Will perform a a local copy for the halo data of a field." alt="" coords="248,23,389,79"/>
<area shape="rect" href="namespacetest__halo__communication__mod.html#ace01cb875dff695ba8c976eff5b98201" title=" " alt="" coords="231,104,407,160"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
<area shape="rect" href="test__halocommunication_8F90.html#a384429ec47961a7f013fa1773326628b" title=" " alt="" coords="9,115,179,157"/>
</map>
</div>

</div>
</div>
<a id="a2eba69a892b0533614ecccad674e61ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2eba69a892b0533614ecccad674e61ed">&#9670;&nbsp;</a></span>perform_local_data_copy_for_field()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public halo_communication_mod::perform_local_data_copy_for_field </td>
          <td>(</td>
          <td class="paramtype">real(kind=default_precision), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>field_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1local__grid__type.html">local_grid_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>local_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>my_rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>halo_depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>involve_corners</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Will perform a a local copy for the halo data of a field. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">field_data</td><td>The field data to perform the copy for </td></tr>
    <tr><td class="paramname">local_grid</td><td>Local grid information </td></tr>
    <tr><td class="paramname">my_rank</td><td>My process id </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00481">481</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: field_data</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordtype">type</span>(local_grid_type), <span class="keywordtype">intent(inout)</span> :: local_grid</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: my_rank, halo_depth</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: involve_corners</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keyword">call </span>perform_local_data_copy_for_dimension(y_index, my_rank, halo_depth, local_grid, &amp;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;         field_data)</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keyword">call </span>perform_local_data_copy_for_dimension(x_index, my_rank, halo_depth, local_grid, &amp;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;         field_data)</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">if</span> (involve_corners) <span class="keyword">call </span>perform_local_data_copy_for_corners(my_rank, local_grid, field_data)</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a2eba69a892b0533614ecccad674e61ed_cgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a2eba69a892b0533614ecccad674e61ed_cgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a2eba69a892b0533614ecccad674e61ed_cgraph" id="anamespacehalo__communication__mod_a2eba69a892b0533614ecccad674e61ed_cgraph">
<area shape="rect" title="Will perform a a local copy for the halo data of a field." alt="" coords="5,45,147,101"/>
<area shape="rect" href="namespacehalo__communication__mod.html#af6146f7138547a3210839b478418856b" title="Performs a local data copy for corners when the neighbour is local (me)" alt="" coords="203,5,363,61"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a82ba20e03d4564be84a6186cfcebfc68" title="Performs a local data copy for a specific dimension of a prognostic field." alt="" coords="195,85,371,141"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a2eba69a892b0533614ecccad674e61ed_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a2eba69a892b0533614ecccad674e61ed_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a2eba69a892b0533614ecccad674e61ed_icgraph" id="anamespacehalo__communication__mod_a2eba69a892b0533614ecccad674e61ed_icgraph">
<area shape="rect" title="Will perform a a local copy for the halo data of a field." alt="" coords="231,20,372,76"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="a4c4471d526bafd49024cd360feeed138"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c4471d526bafd49024cd360feeed138">&#9670;&nbsp;</a></span>populate_halo_swap_neighbours()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structcommunication__types__mod_1_1neighbour__description__type.html">neighbour_description_type</a>) function, dimension(number_distinct_neighbours) halo_communication_mod::populate_halo_swap_neighbours </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1local__grid__type.html">local_grid_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>local_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>my_rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>number_distinct_neighbours</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>involve_corners</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Will populate the halo swap neighbour data strutures with appropriate neighbour pid and dimension numbers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">local_grid</td><td>Description of the local grid </td></tr>
    <tr><td class="paramname">my_rank</td><td>My global PID </td></tr>
    <tr><td class="paramname">number_distinct_neighbours</td><td>The number of distinct neighbours that I have </td></tr>
    <tr><td class="paramname">include_corners</td><td>Whether to include corners or not </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00646">646</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordtype">type</span>(local_grid_type), <span class="keywordtype">intent(inout)</span> :: local_grid</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: my_rank, number_distinct_neighbours</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: involve_corners</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordtype">type</span>(neighbour_description_type), <span class="keywordtype">dimension(number_distinct_neighbours)</span> :: &amp;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;         populate_halo_swap_neighbours</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordtype">integer</span> :: i, j, current_pid_location, temp_neighbour_pids(merge(16, 8, involve_corners))</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160; </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    current_pid_location=0</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    temp_neighbour_pids(:)=-1</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">do</span> i=2,3</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keywordflow">do</span> j=1,4</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="keywordflow">if</span> (local_grid%neighbours(i,j) .ne. my_rank .and. .not. &amp;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;             has_pid_already_been_seen(temp_neighbour_pids, &amp;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;             local_grid%neighbours(i,j))) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;          current_pid_location=current_pid_location+1</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;          populate_halo_swap_neighbours(current_pid_location)%pid=local_grid%neighbours(i,j)</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;          temp_neighbour_pids(current_pid_location)=local_grid%neighbours(i,j)</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;          populate_halo_swap_neighbours(current_pid_location)%dimension=i</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">if</span> (involve_corners) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      <span class="keywordflow">do</span> i=1,<span class="keyword">size</span>(local_grid%corner_neighbours, 2)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">do</span> j=1,<span class="keyword">size</span>(local_grid%corner_neighbours, 1)</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;          <span class="keywordflow">if</span> (local_grid%corner_neighbours(j,i) .ne. my_rank .and. .not. &amp;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;               has_pid_already_been_seen(temp_neighbour_pids, &amp;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;               local_grid%corner_neighbours(j,i))) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            current_pid_location=current_pid_location+1</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            populate_halo_swap_neighbours(current_pid_location)%pid = &amp;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                 local_grid%corner_neighbours(j,i)</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            temp_neighbour_pids(current_pid_location)=local_grid%corner_neighbours(j,i)</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            populate_halo_swap_neighbours(current_pid_location)%dimension=0</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a4c4471d526bafd49024cd360feeed138_cgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a4c4471d526bafd49024cd360feeed138_cgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a4c4471d526bafd49024cd360feeed138_cgraph" id="anamespacehalo__communication__mod_a4c4471d526bafd49024cd360feeed138_cgraph">
<area shape="rect" title="Will populate the halo swap neighbour data strutures with appropriate neighbour pid and dimension num..." alt="" coords="5,5,147,61"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a4529b50fe46e332faf902bfa28144ae9" title="Returns whether or not a specific process id has already been &quot;seen&quot; by searching a list of already s..." alt="" coords="195,5,348,61"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a4c4471d526bafd49024cd360feeed138_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a4c4471d526bafd49024cd360feeed138_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a4c4471d526bafd49024cd360feeed138_icgraph" id="anamespacehalo__communication__mod_a4c4471d526bafd49024cd360feeed138_icgraph">
<area shape="rect" title="Will populate the halo swap neighbour data strutures with appropriate neighbour pid and dimension num..." alt="" coords="481,20,623,76"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ac287e4b520fd9a75f35e58e67ec52880" title="Initialises a halo swapping state, by determining the neighbours, size of data in each swap and alloc..." alt="" coords="231,27,433,69"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
</map>
</div>

</div>
</div>
<a id="a9537cebc6ed24d00aa7e34e6c66a9e29"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9537cebc6ed24d00aa7e34e6c66a9e29">&#9670;&nbsp;</a></span>recv_all_halos()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine halo_communication_mod::recv_all_halos </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1halo__communication__type.html">halo_communication_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>halo_swap_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Registers receive requests for all prognostic fields from the appropriate neighbouring processes (that we have already deduced in the initialisation stage.) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
    <tr><td class="paramname">halo_swap_state</td><td>The halo swap state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00821">821</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keywordtype">type</span>(halo_communication_type), <span class="keywordtype">intent(inout)</span> :: halo_swap_state</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    </div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordtype">integer</span> :: i, request_counter, ierr</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160; </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    request_counter = 1 </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160; </div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">do</span> i = 1, halo_swap_state%number_distinct_neighbours</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;       <span class="keywordflow">if</span> (halo_swap_state%halo_swap_neighbours(i)%recv_size .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;          <span class="keyword">call </span>mpi_irecv(halo_swap_state%halo_swap_neighbours(i)%recv_halo_buffer, &amp;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;               halo_swap_state%halo_swap_neighbours(i)%recv_size, precision_type, &amp;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;               halo_swap_state%halo_swap_neighbours(i)%pid, 0, &amp;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;               current_state%parallel%neighbour_comm, &amp;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;               halo_swap_state%recv_requests(request_counter), ierr)</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;          request_counter = request_counter + 1</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;       <span class="keywordflow">if</span> (halo_swap_state%halo_swap_neighbours(i)%recv_corner_size .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;          <span class="keyword">call </span>mpi_irecv(halo_swap_state%halo_swap_neighbours(i)%recv_corner_buffer, &amp;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;               halo_swap_state%halo_swap_neighbours(i)%recv_corner_size, precision_type, &amp;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;               halo_swap_state%halo_swap_neighbours(i)%pid, 0, &amp;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;               current_state%parallel%neighbour_comm, &amp;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;               halo_swap_state%recv_requests(request_counter), ierr)</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;          request_counter = request_counter + 1</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="keywordflow">    end do</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a9537cebc6ed24d00aa7e34e6c66a9e29_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a9537cebc6ed24d00aa7e34e6c66a9e29_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a9537cebc6ed24d00aa7e34e6c66a9e29_icgraph" id="anamespacehalo__communication__mod_a9537cebc6ed24d00aa7e34e6c66a9e29_icgraph">
<area shape="rect" title="Registers receive requests for all prognostic fields from the appropriate neighbouring processes (tha..." alt="" coords="679,35,821,76"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a8dac8c6529d0169c9e4402690f62d581" title="Initiates a non blocking halo swap, this registers the receive requests, copies data into the send bu..." alt="" coords="456,27,631,83"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a0a11eeeaa1e80eab180fb8652ce592a6" title="Performs the entire halo swap operation, this is simply a wrapper around the nonblocking initiate and..." alt="" coords="231,5,408,47"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,13,183,98"/>
</map>
</div>

</div>
</div>
<a id="a7fb6163656e68853626d592e6d94cd5c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7fb6163656e68853626d592e6d94cd5c">&#9670;&nbsp;</a></span>retrieve_same_neighbour_information()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical function, dimension(3) halo_communication_mod::retrieve_same_neighbour_information </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1local__grid__type.html">local_grid_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>local_grid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves whether we have the same neighbours for L and R halo swaps in each dimension. </p>
<p>This is because if we do then the data storage needs to be reversed - i.e. the first two messages sent to this process are Left and the second two are Right, but due to wrapping around, the L messages need to be put on the right halo and R messages on the left halo </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">neighbours</td><td>The neighbouring processes in each dimension </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l01159">1159</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keywordtype">type</span>(local_grid_type), <span class="keywordtype">intent(inout)</span> :: local_grid</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">!    integer, dimension(:,:), intent(in) :: neighbours</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">dimension(3)</span> :: retrieve_same_neighbour_information</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160; </div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="keywordtype">integer</span> :: i, nd1, nd2</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    </div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    retrieve_same_neighbour_information=(/.true., .true., .true./)</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160; </div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="comment">! halo_size in X and Y are the same, therefore it does not matter which one we take</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="comment">! we multiply by 2 since there are 2 sides Up&amp;Down or Left&amp;Right</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="keywordflow">do</span> i = 1,local_grid%halo_size(y_index)*2</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;       <span class="keywordflow">if</span> (i==1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;          nd1=local_grid%neighbours(y_index,i)</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;          nd2=local_grid%neighbours(x_index,i)</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;       <span class="keywordflow">else</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;          <span class="keywordflow">if</span> (local_grid%neighbours(y_index,i) .ne. nd1) &amp;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;               retrieve_same_neighbour_information(y_index) = .false.</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;          <span class="keywordflow">if</span> (local_grid%neighbours(x_index,i) .ne. nd2) &amp;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;               retrieve_same_neighbour_information(x_index) = .false.</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="keywordflow">    end do</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a7fb6163656e68853626d592e6d94cd5c_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a7fb6163656e68853626d592e6d94cd5c_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a7fb6163656e68853626d592e6d94cd5c_icgraph" id="anamespacehalo__communication__mod_a7fb6163656e68853626d592e6d94cd5c_icgraph">
<area shape="rect" title="Retrieves whether we have the same neighbours for L and R halo swaps in each dimension." alt="" coords="700,60,856,116"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a65991d14beaafd48f7841ccc35be5e98" title="Precalculates the received buffer to field halo cell matches for each dimension and called from the i..." alt="" coords="493,20,641,76"/>
<area shape="rect" href="namespacetest__halo__communication__mod.html#a9d4febce57e215c67cc7319f1988f203" title=" " alt="" coords="481,100,652,156"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ac287e4b520fd9a75f35e58e67ec52880" title="Initialises a halo swapping state, by determining the neighbours, size of data in each swap and alloc..." alt="" coords="231,27,433,69"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,5,183,91"/>
<area shape="rect" href="test__halocommunication_8F90.html#a384429ec47961a7f013fa1773326628b" title=" " alt="" coords="247,107,417,149"/>
</map>
</div>

</div>
</div>
<a id="a0e57e9753603d764609afb1f4cb2087b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e57e9753603d764609afb1f4cb2087b">&#9670;&nbsp;</a></span>send_all_halos()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine halo_communication_mod::send_all_halos </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1halo__communication__type.html">halo_communication_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>halo_swap_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1copy__fields__to__halo__buffer__proc__interface.html">copy_fields_to_halo_buffer_proc_interface</a>)&#160;</td>
          <td class="paramname"><em>copy_fields_to_halo_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">procedure(<a class="el" href="interfacehalo__communication__mod_1_1copy__corners__to__halo__buffer__proc__interface.html">copy_corners_to_halo_buffer_proc_interface</a>), optional&#160;</td>
          <td class="paramname"><em>copy_corner_fields_to_halo_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1field__data__wrapper__type.html">field_data_wrapper_type</a>), dimension(:), intent(in), optional&#160;</td>
          <td class="paramname"><em>source_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Copies all applicable bits of the prognostics into a send buffer for each neighbour and then issues asynchronous sends of this data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
    <tr><td class="paramname">halo_swap_state</td><td>The halo swap state </td></tr>
    <tr><td class="paramname">copy_fields_to_halo_buffer</td><td>Procedure pointer to copy the data from the fields into the send buffer </td></tr>
    <tr><td class="paramname">copy_corner_fields_to_halo_buffer</td><td>Optional procedure pointer to copy corner fields into halo send buffer </td></tr>
    <tr><td class="paramname">source_data</td><td>Optional field data that can be copied from (passed to the user procedure) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="halocommunication_8F90_source.html#l00858">858</a> of file <a class="el" href="halocommunication_8F90_source.html">halocommunication.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordtype">type</span>(halo_communication_type), <span class="keywordtype">intent(inout)</span> :: halo_swap_state</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="keywordtype">procedure</span>(copy_fields_to_halo_buffer_proc_interface) :: copy_fields_to_halo_buffer</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordtype">procedure</span>(copy_corners_to_halo_buffer_proc_interface), <span class="keywordtype">optional</span> :: &amp;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;         copy_corner_fields_to_halo_buffer</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="keywordtype">type</span>(field_data_wrapper_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: source_data</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160; </div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="keywordtype">integer</span> :: i, j, ierr,hstart, hend, pid_location, source_index, request_number, &amp;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;         x_source_index, y_source_index, current_page(halo_swap_state%number_distinct_neighbours),&amp;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;         halo_depth</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="comment">! halo_size(Y_INDEX) = halo_size(X_INDEX), just pick one</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    halo_depth = current_state%local_grid%halo_size(y_index)</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    current_page(:) = 1</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    request_number = 1</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="comment">! TODO: hardcoded to halodepth 1 or 2</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    hstart = merge(2, 1, halo_swap_state%halo_depth==1)</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    hend = merge(3, halo_depth*2, halo_swap_state%halo_depth==1)</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    </div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="keywordflow">do</span> i=2, 3</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;       <span class="keywordflow">do</span> j=hstart, hend</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;          <span class="keywordflow">if</span> (current_state%parallel%my_rank .ne. current_state%local_grid%neighbours(i,j)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;             </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;             <span class="keywordflow">if</span> (j==1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                source_index = current_state%local_grid%local_domain_start_index(i)</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j==2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                source_index = current_state%local_grid%local_domain_start_index(i) + &amp;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                     merge(1, 0, halo_swap_state%halo_depth .ne. 1)</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j==3) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                source_index = current_state%local_grid%local_domain_end_index(i) - &amp;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                     merge(1, 0, halo_swap_state%halo_depth .ne. 1)</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j==4) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                source_index = current_state%local_grid%local_domain_end_index(i)</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="keywordflow">             end if</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;             </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;             pid_location = get_pid_neighbour_location(halo_swap_state%halo_swap_neighbours, &amp;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                  current_state%local_grid%neighbours(i,j), &amp;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                  halo_swap_state%number_distinct_neighbours)</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160; </div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;             <span class="keywordflow">if</span> (<span class="keyword">present</span>(source_data)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                <span class="keyword">call </span>copy_fields_to_halo_buffer(current_state, &amp;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                     halo_swap_state%halo_swap_neighbours(pid_location), i, source_index, &amp;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                     pid_location, current_page, source_data)</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                <span class="keyword">call </span>copy_fields_to_halo_buffer(current_state, &amp;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                     halo_swap_state%halo_swap_neighbours(pid_location), i, source_index, &amp;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                     pid_location, current_page)</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="keywordflow">             end if</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;             <span class="comment">! call log_log(LOG_DEBUG, &quot;PID =&quot;//trim(conv_to_String(&amp;</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;             <span class="comment">!current_state%parallel%my_rank))//&quot; source_index = &quot;//&amp;</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;             <span class="comment">!      trim(conv_to_string(source_index))//&quot; PID location =&quot;//trim(&amp;</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;             <span class="comment">!conv_to_string(pid_location))//&amp;</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;             <span class="comment">!      &quot; i= &quot;//trim(conv_to_string(i))//&quot; j=&quot;//trim(conv_to_string(j)))</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    </div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(copy_corner_fields_to_halo_buffer)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;       current_page(:)=1</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;       <span class="keywordflow">do</span> j = 1, <span class="keyword">size</span>(current_state%local_grid%corner_neighbours, 1)</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;          <span class="keywordflow">if</span> (current_state%parallel%my_rank .ne. &amp;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;               current_state%local_grid%corner_neighbours(j,1)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;             x_source_index = merge(current_state%local_grid%local_domain_start_index(x_index)+1,&amp;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                  current_state%local_grid%local_domain_end_index(x_index)-1, j==1 .or. j==3)</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;             y_source_index  =merge(current_state%local_grid%local_domain_start_index(y_index)+1,&amp;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                  current_state%local_grid%local_domain_end_index(y_index)-1, j==1 .or. j==2)</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;             pid_location = get_pid_neighbour_location(halo_swap_state%halo_swap_neighbours, &amp;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                  current_state%local_grid%corner_neighbours(j,1), &amp;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                  halo_swap_state%number_distinct_neighbours)</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;             <span class="keywordflow">if</span> (<span class="keyword">present</span>(source_data)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                <span class="keyword">call </span>copy_corner_fields_to_halo_buffer(current_state, &amp;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                     halo_swap_state%halo_swap_neighbours(pid_location), j, &amp;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                     x_source_index, y_source_index, pid_location, current_page, source_data)</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                <span class="keyword">call </span>copy_corner_fields_to_halo_buffer(current_state, &amp;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                     halo_swap_state%halo_swap_neighbours(pid_location), j, &amp;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                     x_source_index, y_source_index, pid_location, current_page)</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="keywordflow">             end if</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    </div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordflow">do</span> i=1,halo_swap_state%number_distinct_neighbours</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;       <span class="keywordflow">if</span> (halo_swap_state%halo_swap_neighbours(i)%send_size .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;          <span class="keyword">call </span>mpi_isend(halo_swap_state%halo_swap_neighbours(i)%send_halo_buffer, &amp;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;               halo_swap_state%halo_swap_neighbours(i)%send_size, precision_type, &amp;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;               halo_swap_state%halo_swap_neighbours(i)%pid, 0, &amp;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;               current_state%parallel%neighbour_comm, &amp;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;               halo_swap_state%send_requests(request_number), ierr)</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;          request_number = request_number+1</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;       <span class="keywordflow">if</span> (halo_swap_state%halo_swap_neighbours(i)%send_corner_size .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;          <span class="keyword">call </span>mpi_isend(halo_swap_state%halo_swap_neighbours(i)%send_corner_buffer, &amp;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;               halo_swap_state%halo_swap_neighbours(i)%send_corner_size, precision_type, &amp;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;               halo_swap_state%halo_swap_neighbours(i)%pid, 0, &amp;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;               current_state%parallel%neighbour_comm, &amp;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;               halo_swap_state%send_requests(request_number), ierr)</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;          request_number = request_number+1</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="keywordflow">    end do</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a0e57e9753603d764609afb1f4cb2087b_cgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a0e57e9753603d764609afb1f4cb2087b_cgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a0e57e9753603d764609afb1f4cb2087b_cgraph" id="anamespacehalo__communication__mod_a0e57e9753603d764609afb1f4cb2087b_cgraph">
<area shape="rect" title="Copies all applicable bits of the prognostics into a send buffer for each neighbour and then issues a..." alt="" coords="5,13,152,54"/>
<area shape="rect" href="namespacehalo__communication__mod.html#ab0dc177b2189be5b8ed3877e6081e459" title="Given the process id of a neighbour this determines the location in the data structure of correspondi..." alt="" coords="200,5,365,61"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacehalo__communication__mod_a0e57e9753603d764609afb1f4cb2087b_icgraph.png" border="0" usemap="#anamespacehalo__communication__mod_a0e57e9753603d764609afb1f4cb2087b_icgraph" alt=""/></div>
<map name="namespacehalo__communication__mod_a0e57e9753603d764609afb1f4cb2087b_icgraph" id="anamespacehalo__communication__mod_a0e57e9753603d764609afb1f4cb2087b_icgraph">
<area shape="rect" title="Copies all applicable bits of the prognostics into a send buffer for each neighbour and then issues a..." alt="" coords="679,35,825,76"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a8dac8c6529d0169c9e4402690f62d581" title="Initiates a non blocking halo swap, this registers the receive requests, copies data into the send bu..." alt="" coords="456,27,631,83"/>
<area shape="rect" href="namespacehalo__communication__mod.html#a0a11eeeaa1e80eab180fb8652ce592a6" title="Performs the entire halo swap operation, this is simply a wrapper around the nonblocking initiate and..." alt="" coords="231,5,408,47"/>
<area shape="rect" href="interfacehalo__communication__mod_1_1perform__local__data__copy__proc__interface.html#a9f668d078f8cd3153d4bbde17cdbee41" title=" " alt="" coords="5,13,183,98"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<div class="ttc" id="anamespacelogging__mod_html_ad68309846cd8f9e77edaa6abd02f65a0"><div class="ttname"><a href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">logging_mod::log_error</a></div><div class="ttdeci">integer, parameter, public log_error</div><div class="ttdoc">Only log ERROR messages.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00011">logging.F90:11</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_a10e28447dd10ef9f92d205bc98fb26d3"><div class="ttname"><a href="namespacelogging__mod.html#a10e28447dd10ef9f92d205bc98fb26d3">logging_mod::log_warn</a></div><div class="ttdeci">integer, parameter, public log_warn</div><div class="ttdoc">Log WARNING and ERROR messages.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00012">logging.F90:12</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_ac4f13ac385499c85190cb184030e4f45"><div class="ttname"><a href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">logging_mod::log_log</a></div><div class="ttdeci">subroutine, public log_log(level, message, str)</div><div class="ttdoc">Logs a message at the specified level. If the level is above the current level then the message is ig...</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00074">logging.F90:75</a></div></div>
<div class="ttc" id="anamespacedatadefn__mod_html_a39b79f8cc843d236d3b47f5c81b64368"><div class="ttname"><a href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">datadefn_mod::default_precision</a></div><div class="ttdeci">integer, parameter, public default_precision</div><div class="ttdoc">MPI communication type which we use for the prognostic and calculation data.</div><div class="ttdef"><b>Definition:</b> <a href="datadefn_8F90_source.html#l00017">datadefn.F90:17</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
